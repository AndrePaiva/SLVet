(function(e,t,n){var r=function(e,r){"use strict";var i=function(t,n){if(!this.CLASS||this.CLASS!="ColVis"){alert("Warning: ColVis must be initialised with the keyword 'new'")}if(typeof n=="undefined"){n={}}if(e.fn.dataTable.camelToHungarian){e.fn.dataTable.camelToHungarian(i.defaults,n)}this.s={dt:null,oInit:n,hidden:true,abOriginal:[]};this.dom={wrapper:null,button:null,collection:null,background:null,catcher:null,buttons:[],groupButtons:[],restore:null};i.aInstances.push(this);this.s.dt=e.fn.dataTable.Api?(new e.fn.dataTable.Api(t)).settings()[0]:t;this._fnConstruct(n);return this};i.prototype={button:function(){return this.dom.wrapper},fnRebuild:function(){this.rebuild()},rebuild:function(){for(var e=this.dom.buttons.length-1;e>=0;e--){this.dom.collection.removeChild(this.dom.buttons[e])}this.dom.buttons.splice(0,this.dom.buttons.length);if(this.dom.restore){this.dom.restore.parentNode(this.dom.restore)}this._fnAddGroups();this._fnAddButtons();this._fnDrawCallback()},_fnConstruct:function(n){this._fnApplyCustomisation(n);var r=this;var i,s;this.dom.wrapper=t.createElement("div");this.dom.wrapper.className="ColVis";this.dom.button=e("<button />",{"class":!this.s.dt.bJUI?"ColVis_Button ColVis_MasterButton":"ColVis_Button ColVis_MasterButton ui-button ui-state-default"}).append("<span>"+this.s.buttonText+"</span>").bind(this.s.activate=="mouseover"?"mouseover":"click",function(e){e.preventDefault();r._fnCollectionShow()}).appendTo(this.dom.wrapper)[0];this.dom.catcher=this._fnDomCatcher();this.dom.collection=this._fnDomCollection();this.dom.background=this._fnDomBackground();this._fnAddGroups();this._fnAddButtons();for(i=0,s=this.s.dt.aoColumns.length;i<s;i++){this.s.abOriginal.push(this.s.dt.aoColumns[i].bVisible)}this.s.dt.aoDrawCallback.push({fn:function(){r._fnDrawCallback.call(r)},sName:"ColVis"});e(this.s.dt.oInstance).bind("column-reorder",function(e,t,n){for(i=0,s=r.s.aiExclude.length;i<s;i++){r.s.aiExclude[i]=n.aiInvertMapping[r.s.aiExclude[i]]}var o=r.s.abOriginal.splice(n.iFrom,1)[0];r.s.abOriginal.splice(n.iTo,0,o);r.fnRebuild()});this._fnDrawCallback()},_fnApplyCustomisation:function(t){e.extend(true,this.s,i.defaults,t);if(!this.s.showAll&&this.s.bShowAll){this.s.showAll=this.s.sShowAll}if(!this.s.restore&&this.s.bRestore){this.s.restore=this.s.sRestore}var n=this.s.groups;var r=this.s.aoGroups;if(n){for(var s=0,o=n.length;s<o;s++){if(n[s].title){r[s].sTitle=n[s].title}if(n[s].columns){r[s].aiColumns=n[s].columns}}}},_fnDrawCallback:function(){var t=this.s.dt.aoColumns;var r=this.dom.buttons;var i=this.s.aoGroups;var s;for(var o=0,u=r.length;o<u;o++){s=r[o];if(s.__columnIdx!==n){e("input",s).prop("checked",t[s.__columnIdx].bVisible)}}var a=function(e){for(var n=0,r=e.length;n<r;n++){if(t[e[n]].bVisible===false){return false}}return true};var f=function(e){for(var n=0,r=e.length;n<r;n++){if(t[e[n]].bVisible===true){return false}}return true};for(var l=0,c=i.length;l<c;l++){if(a(i[l].aiColumns)){e("input",this.dom.groupButtons[l]).prop("checked",true);e("input",this.dom.groupButtons[l]).prop("indeterminate",false)}else if(f(i[l].aiColumns)){e("input",this.dom.groupButtons[l]).prop("checked",false);e("input",this.dom.groupButtons[l]).prop("indeterminate",false)}else{e("input",this.dom.groupButtons[l]).prop("indeterminate",true)}}},_fnAddGroups:function(){var e;if(typeof this.s.aoGroups!="undefined"){for(var t=0,n=this.s.aoGroups.length;t<n;t++){e=this._fnDomGroupButton(t);this.dom.groupButtons.push(e);this.dom.buttons.push(e);this.dom.collection.appendChild(e)}}},_fnAddButtons:function(){var t,n=this.s.dt.aoColumns;if(e.inArray("all",this.s.aiExclude)===-1){for(var r=0,i=n.length;r<i;r++){if(e.inArray(r,this.s.aiExclude)===-1){t=this._fnDomColumnButton(r);t.__columnIdx=r;this.dom.buttons.push(t)}}}if(this.s.order==="alpha"){this.dom.buttons.sort(function(e,t){var r=n[e.__columnIdx].sTitle;var i=n[t.__columnIdx].sTitle;return r===i?0:r<i?-1:1})}if(this.s.restore){t=this._fnDomRestoreButton();t.className+=" ColVis_Restore";this.dom.buttons.push(t)}if(this.s.showAll){t=this._fnDomShowAllButton();t.className+=" ColVis_ShowAll";this.dom.buttons.push(t)}e(this.dom.collection).append(this.dom.buttons)},_fnDomRestoreButton:function(){var t=this,n=this.s.dt;return e('<li class="ColVis_Special '+(n.bJUI?"ui-button ui-state-default":"")+'">'+this.s.restore+"</li>").click(function(e){for(var n=0,r=t.s.abOriginal.length;n<r;n++){t.s.dt.oInstance.fnSetColumnVis(n,t.s.abOriginal[n],false)}t._fnAdjustOpenRows();t.s.dt.oInstance.fnAdjustColumnSizing(false);t.s.dt.oInstance.fnDraw(false)})[0]},_fnDomShowAllButton:function(){var t=this,n=this.s.dt;return e('<li class="ColVis_Special '+(n.bJUI?"ui-button ui-state-default":"")+'">'+this.s.showAll+"</li>").click(function(e){for(var n=0,r=t.s.abOriginal.length;n<r;n++){if(t.s.aiExclude.indexOf(n)===-1){t.s.dt.oInstance.fnSetColumnVis(n,true,false)}}t._fnAdjustOpenRows();t.s.dt.oInstance.fnAdjustColumnSizing(false);t.s.dt.oInstance.fnDraw(false)})[0]},_fnDomGroupButton:function(t){var n=this,r=this.s.dt,i=this.s.aoGroups[t];return e('<li class="ColVis_Special '+(r.bJUI?"ui-button ui-state-default":"")+'">'+"<label>"+'<input type="checkbox" />'+"<span>"+i.sTitle+"</span>"+"</label>"+"</li>").click(function(t){var r=!e("input",this).is(":checked");if(t.target.nodeName.toLowerCase()!=="li"){r=!r}for(var s=0;s<i.aiColumns.length;s++){n.s.dt.oInstance.fnSetColumnVis(i.aiColumns[s],r)}})[0]},_fnDomColumnButton:function(t){var n=this,r=this.s.dt.aoColumns[t],i=this.s.dt;var s=this.s.fnLabel===null?r.sTitle:this.s.fnLabel(t,r.sTitle,r.nTh);return e("<li "+(i.bJUI?'class="ui-button ui-state-default"':"")+">"+"<label>"+'<input type="checkbox" />'+"<span>"+s+"</span>"+"</label>"+"</li>").click(function(r){var s=!e("input",this).is(":checked");if(r.target.nodeName.toLowerCase()!=="li"){s=!s}var o=e.fn.dataTableExt.iApiIndex;e.fn.dataTableExt.iApiIndex=n._fnDataTablesApiIndex.call(n);if(i.oFeatures.bServerSide){n.s.dt.oInstance.fnSetColumnVis(t,s,false);n.s.dt.oInstance.fnAdjustColumnSizing(false);if(i.oScroll.sX!==""||i.oScroll.sY!==""){n.s.dt.oInstance.oApi._fnScrollDraw(n.s.dt)}n._fnDrawCallback()}else{n.s.dt.oInstance.fnSetColumnVis(t,s)}e.fn.dataTableExt.iApiIndex=o;if(n.s.fnStateChange!==null){n.s.fnStateChange.call(n,t,s)}})[0]},_fnDataTablesApiIndex:function(){for(var e=0,t=this.s.dt.oInstance.length;e<t;e++){if(this.s.dt.oInstance[e]==this.s.dt.nTable){return e}}return 0},_fnDomCollection:function(){return e("<ul />",{"class":!this.s.dt.bJUI?"ColVis_collection":"ColVis_collection ui-buttonset ui-buttonset-multi"}).css({display:"none",opacity:0,position:!this.s.bCssPosition?"absolute":""})[0]},_fnDomCatcher:function(){var n=this,r=t.createElement("div");r.className="ColVis_catcher";e(r).click(function(){n._fnCollectionHide.call(n,null,null)});return r},_fnDomBackground:function(){var t=this;var n=e("<div></div>").addClass("ColVis_collectionBackground").css("opacity",0).click(function(){t._fnCollectionHide.call(t,null,null)});if(this.s.activate=="mouseover"){n.mouseover(function(){t.s.overcollection=false;t._fnCollectionHide.call(t,null,null)})}return n[0]},_fnCollectionShow:function(){var n=this,r,i,s;var o=e(this.dom.button).offset();var u=this.dom.collection;var a=this.dom.background;var f=parseInt(o.left,10);var l=parseInt(o.top+e(this.dom.button).outerHeight(),10);if(!this.s.bCssPosition){u.style.top=l+"px";u.style.left=f+"px"}e(u).css({display:"block",opacity:0});a.style.bottom="0px";a.style.right="0px";var c=this.dom.catcher.style;c.height=e(this.dom.button).outerHeight()+"px";c.width=e(this.dom.button).outerWidth()+"px";c.top=o.top+"px";c.left=f+"px";t.body.appendChild(a);t.body.appendChild(u);t.body.appendChild(this.dom.catcher);e(u).animate({opacity:1},n.s.iOverlayFade);e(a).animate({opacity:.1},n.s.iOverlayFade,"linear",function(){if(e.browser&&e.browser.msie&&e.browser.version=="6.0"){n._fnDrawCallback()}});if(!this.s.bCssPosition){s=this.s.sAlign=="left"?f:f-e(u).outerWidth()+e(this.dom.button).outerWidth();u.style.left=s+"px";var h=e(u).outerWidth();var p=e(u).outerHeight();var d=e(t).width();if(s+h>d){u.style.left=d-h+"px"}}this.s.hidden=false},_fnCollectionHide:function(){var n=this;if(!this.s.hidden&&this.dom.collection!==null){this.s.hidden=true;e(this.dom.collection).animate({opacity:0},n.s.iOverlayFade,function(e){this.style.display="none"});e(this.dom.background).animate({opacity:0},n.s.iOverlayFade,function(e){t.body.removeChild(n.dom.background);t.body.removeChild(n.dom.catcher)})}},_fnAdjustOpenRows:function(){var e=this.s.dt.aoOpenRows;var t=this.s.dt.oApi._fnVisbleColumns(this.s.dt);for(var n=0,r=e.length;n<r;n++){e[n].nTr.getElementsByTagName("td")[0].colSpan=t}}};i.fnRebuild=function(e){var t=null;if(typeof e!="undefined"){t=e.fnSettings().nTable}for(var n=0,r=i.aInstances.length;n<r;n++){if(typeof e=="undefined"||t==i.aInstances[n].s.dt.nTable){i.aInstances[n].fnRebuild()}}};i.defaults={active:"click",buttonText:"Show / hide columns",aiExclude:[],bRestore:false,sRestore:"Restore original",bShowAll:false,sShowAll:"Show All",sAlign:"left",fnStateChange:null,iOverlayFade:500,fnLabel:null,bCssPosition:false,aoGroups:[],order:"column"};i.aInstances=[];i.prototype.CLASS="ColVis";i.VERSION="1.1.0";i.prototype.VERSION=i.VERSION;if(typeof e.fn.dataTable=="function"&&typeof e.fn.dataTableExt.fnVersionCheck=="function"&&e.fn.dataTableExt.fnVersionCheck("1.7.0")){e.fn.dataTableExt.aoFeatures.push({fnInit:function(e){var t=e.oInit;var n=new i(e,t.colVis||t.oColVis||{});return n.button()},cFeature:"C",sFeature:"ColVis"})}else{alert("Warning: ColVis requires DataTables 1.7 or greater - www.datatables.net/download")}e.fn.dataTable.ColVis=i;e.fn.DataTable.ColVis=i;return i};if(typeof define==="function"&&define.amd){define("datatables-colvis",["jquery","datatables"],r)}else if(jQuery&&!jQuery.fn.dataTable.ColVis){r(jQuery,jQuery.fn.dataTable)}})(window,document)