jQuery.fn.searchFilter=function(e,t){function n(e,t,n){this.$=e;this.add=function(t){if(t==null)e.find(".ui-add-last").click();else e.find(".sf:eq("+t+") .ui-add").click();return this};this.del=function(t){if(t==null)e.find(".sf:last .ui-del").click();else e.find(".sf:eq("+t+") .ui-del").click();return this};this.search=function(t){e.find(".ui-search").click();return this};this.reset=function(t){if(t===undefined)t=false;e.find(".ui-reset").trigger("click",[t]);return this};this.close=function(){e.find(".ui-closer").click();return this};if(t!=null){function r(){jQuery(this).toggleClass("ui-state-hover");return false}function i(e){jQuery(this).toggleClass("ui-state-active",e.type=="mousedown");return false}function s(e,t){return"<option value='"+e+"'>"+t+"</option>"}function o(e,t,n){return"<select class='"+e+"'"+(n?" style='display:none;'":"")+">"+t+"</select>"}function u(t,n){var r=e.find("tr.sf td.data "+t);if(r[0]!=null)n(r)}function a(t,n){var r=e.find("tr.sf td.data "+t);if(r[0]!=null){jQuery.each(n,function(){if(this.data!=null)r.bind(this.type,this.data,this.fn);else r.bind(this.type,this.fn)})}}var f=jQuery.extend({},jQuery.fn.searchFilter.defaults,n);var l=-1;var c="";jQuery.each(f.groupOps,function(){c+=s(this.op,this.text)});c="<select name='groupOp'>"+c+"</select>";e.html("").addClass("ui-searchFilter").append("<div class='ui-widget-overlay' style='z-index: -1'>&#160;</div><table class='ui-widget-content ui-corner-all'><thead><tr><td colspan='5' class='ui-widget-header ui-corner-all' style='line-height: 18px;'><div class='ui-closer ui-state-default ui-corner-all ui-helper-clearfix' style='float: right;'><span class='ui-icon ui-icon-close'></span></div>"+f.windowTitle+"</td></tr></thead><tbody><tr class='sf'><td class='fields'></td><td class='ops'></td><td class='data'></td><td><div class='ui-del ui-state-default ui-corner-all'><span class='ui-icon ui-icon-minus'></span></div></td><td><div class='ui-add ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plus'></span></div></td></tr><tr><td colspan='5' class='divider'><hr class='ui-widget-content' style='margin:1px'/></td></tr></tbody><tfoot><tr><td colspan='3'><span class='ui-reset ui-state-default ui-corner-all' style='display: inline-block; float: left;'><span class='ui-icon ui-icon-arrowreturnthick-1-w' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+f.resetText+"</span></span><span class='ui-search ui-state-default ui-corner-all' style='display: inline-block; float: right;'><span class='ui-icon ui-icon-search' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+f.searchText+"</span></span><span class='matchText'>"+f.matchText+"</span> "+c+" <span class='rulesText'>"+f.rulesText+"</span></td><td>&#160;</td><td><div class='ui-add-last ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plusthick'></span></div></td></tr></tfoot></table>");var h=e.find("tr.sf");var p=h.find("td.fields");var d=h.find("td.ops");var v=h.find("td.data");var m="";jQuery.each(f.operators,function(){m+=s(this.op,this.text)});m=o("default",m,true);d.append(m);var g="<input type='text' class='default' style='display:none;' />";v.append(g);var y="";var b=false;var w=false;jQuery.each(t,function(t){var n=t;y+=s(this.itemval,this.text);if(this.ops!=null){b=true;var r="";jQuery.each(this.ops,function(){r+=s(this.op,this.text)});r=o("field"+n,r,true);d.append(r)}if(this.dataUrl!=null){if(t>l)l=t;w=true;var i=this.dataEvents;var c=this.dataInit;var h=this.buildSelect;jQuery.ajax(jQuery.extend({url:this.dataUrl,complete:function(r){var s;if(h!=null)s=jQuery("<div />").append(h(r));else s=jQuery("<div />").append(r.responseText);s.find("select").addClass("field"+n).hide();v.append(s.html());if(c)u(".field"+t,c);if(i)a(".field"+t,i);if(t==l){e.find("tr.sf td.fields select[name='field']").change()}}},f.ajaxSelectOptions))}else if(this.dataValues!=null){w=true;var p="";jQuery.each(this.dataValues,function(){p+=s(this.value,this.text)});p=o("field"+n,p,true);v.append(p)}else if(this.dataEvents!=null||this.dataInit!=null){w=true;var p="<input type='text' class='field"+n+"' />";v.append(p)}if(this.dataInit!=null&&t!=l)u(".field"+t,this.dataInit);if(this.dataEvents!=null&&t!=l)a(".field"+t,this.dataEvents)});y="<select name='field'>"+y+"</select>";p.append(y);var E=p.find("select[name='field']");if(b)E.change(function(e){var t=e.target.selectedIndex;var n=jQuery(e.target).parents("tr.sf").find("td.ops");n.find("select").removeAttr("name").hide();var r=n.find(".field"+t);if(r[0]==null)r=n.find(".default");r.attr("name","op").show();return false});else d.find(".default").attr("name","op").show();if(w)E.change(function(e){var t=e.target.selectedIndex;var n=jQuery(e.target).parents("tr.sf").find("td.data");n.find("select,input").removeClass("vdata").hide();var r=n.find(".field"+t);if(r[0]==null)r=n.find(".default");r.show().addClass("vdata");return false});else v.find(".default").show().addClass("vdata");if(b||w)E.change();e.find(".ui-state-default").hover(r,r).mousedown(i).mouseup(i);e.find(".ui-closer").click(function(t){f.onClose(jQuery(e.selector));return false});e.find(".ui-del").click(function(e){var t=jQuery(e.target).parents(".sf");if(t.siblings(".sf").length>0){if(f.datepickerFix===true&&jQuery.fn.datepicker!==undefined)t.find(".hasDatepicker").datepicker("destroy");t.remove()}else{t.find("select[name='field']")[0].selectedIndex=0;t.find("select[name='op']")[0].selectedIndex=0;t.find(".data input").val("");t.find(".data select").each(function(){this.selectedIndex=0});t.find("select[name='field']").change(function(e){e.stopPropagation()})}return false});e.find(".ui-add").click(function(e){var t=jQuery(e.target).parents(".sf");var n=t.clone(true).insertAfter(t);n.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");if(f.clone){n.find("select[name='field']")[0].selectedIndex=t.find("select[name='field']")[0].selectedIndex;var r=n.find("select[name='op']")[0]==null;if(!r)n.find("select[name='op']").focus()[0].selectedIndex=t.find("select[name='op']")[0].selectedIndex;var i=n.find("select.vdata");if(i[0]!=null)i[0].selectedIndex=t.find("select.vdata")[0].selectedIndex}else{n.find(".data input").val("");n.find("select[name='field']").focus()}if(f.datepickerFix===true&&jQuery.fn.datepicker!==undefined){t.find(".hasDatepicker").each(function(){var e=jQuery.data(this,"datepicker").settings;n.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(e)})}n.find("select[name='field']").change(function(e){e.stopPropagation()});return false});e.find(".ui-search").click(function(t){var n=jQuery(e.selector);var r;var i=n.find("select[name='groupOp'] :selected").val();if(!f.stringResult){r={groupOp:i,rules:[]}}else{r='{"groupOp":"'+i+'","rules":['}n.find(".sf").each(function(e){var t=jQuery(this).find("select[name='field'] :selected").val();var n=jQuery(this).find("select[name='op'] :selected").val();var i=jQuery(this).find("input.vdata,select.vdata :selected").val();i+="";if(!f.stringResult){r.rules.push({field:t,op:n,data:i})}else{i=i.replace(/\\/g,"\\\\").replace(/\"/g,'\\"');if(e>0)r+=",";r+='{"field":"'+t+'",';r+='"op":"'+n+'",';r+='"data":"'+i+'"}'}});if(f.stringResult)r+="]}";f.onSearch(r);return false});e.find(".ui-reset").click(function(t,n){var r=jQuery(e.selector);r.find(".ui-del").click();r.find("select[name='groupOp']")[0].selectedIndex=0;f.onReset(n);return false});e.find(".ui-add-last").click(function(){var t=jQuery(e.selector+" .sf:last");var n=t.clone(true).insertAfter(t);n.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");n.find(".data input").val("");n.find("select[name='field']").focus();if(f.datepickerFix===true&&jQuery.fn.datepicker!==undefined){t.find(".hasDatepicker").each(function(){var e=jQuery.data(this,"datepicker").settings;n.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(e)})}n.find("select[name='field']").change(function(e){e.stopPropagation()});return false});this.setGroupOp=function(t){selDOMobj=e.find("select[name='groupOp']")[0];var n={},r=selDOMobj.options.length,i;for(i=0;i<r;i++){n[selDOMobj.options[i].value]=i}selDOMobj.selectedIndex=n[t];jQuery(selDOMobj).change(function(e){e.stopPropagation()})};this.setFilter=function(e){var t=e["sfref"],r=e["filter"];var i=[],s,o,u,a,f,l={};selDOMobj=t.find("select[name='field']")[0];for(s=0,u=selDOMobj.options.length;s<u;s++){l[selDOMobj.options[s].value]={index:s,ops:{}};i.push(selDOMobj.options[s].value)}for(s=0,f=i.length;s<f;s++){selDOMobj=t.find(".ops > select[class='field"+s+"']")[0];if(selDOMobj){for(o=0,a=selDOMobj.options.length;o<a;o++){l[i[s]]["ops"][selDOMobj.options[o].value]=o}}selDOMobj=t.find(".data > select[class='field"+s+"']")[0];if(selDOMobj){l[i[s]]["data"]={};for(o=0,a=selDOMobj.options.length;o<a;o++){l[i[s]]["data"][selDOMobj.options[o].value]=o}}}var c,h,p,d,v;c=r["field"];if(l[c]){h=l[c]["index"]}if(h!=null){p=l[c]["ops"][r["op"]];if(p===undefined){for(s=0,f=n.operators.length;s<f;s++){if(n.operators[s].op==r.op){p=s;break}}}d=r["data"];if(l[c]["data"]==null){v=-1}else{v=l[c]["data"][d]}}if(h!=null&&p!=null&&v!=null){t.find("select[name='field']")[0].selectedIndex=h;t.find("select[name='field']").change();t.find("select[name='op']")[0].selectedIndex=p;t.find("input.vdata").val(d);t=t.find("select.vdata")[0];if(t){t.selectedIndex=v}return true}else{return false}}}}return new n(this,e,t)};jQuery.fn.searchFilter.version="1.2.9";jQuery.fn.searchFilter.defaults={clone:true,datepickerFix:true,onReset:function(e){alert("Reset Clicked. Data Returned: "+e)},onSearch:function(e){alert("Search Clicked. Data Returned: "+e)},onClose:function(e){e.hide()},groupOps:[{op:"AND",text:"all"},{op:"OR",text:"any"}],operators:[{op:"eq",text:"is equal to"},{op:"ne",text:"is not equal to"},{op:"lt",text:"is less than"},{op:"le",text:"is less or equal to"},{op:"gt",text:"is greater than"},{op:"ge",text:"is greater or equal to"},{op:"in",text:"is in"},{op:"ni",text:"is not in"},{op:"bw",text:"begins with"},{op:"bn",text:"does not begin with"},{op:"ew",text:"ends with"},{op:"en",text:"does not end with"},{op:"cn",text:"contains"},{op:"nc",text:"does not contain"}],matchText:"match",rulesText:"rules",resetText:"Reset",searchText:"Search",stringResult:true,windowTitle:"Search Rules",ajaxSelectOptions:{}}