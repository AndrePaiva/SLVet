var TableQueryWrapper=function(e,t,n){this.table=new google.visualization.Table(t);this.query=e;this.sortQueryClause="";this.pageQueryClause="";this.container=t;this.currentDataTable=null;var r=this;var i=google.visualization.events.addListener;i(this.table,"page",function(e){r.handlePage(e)});i(this.table,"sort",function(e){r.handleSort(e)});n=n||{};n=TableQueryWrapper.clone(n);n["sort"]="event";n["page"]="event";var s="pagingButtonsConfiguration";n[s]=n[s]||"both";n["pageSize"]=n["pageSize"]>0?n["pageSize"]:10;this.pageSize=n["pageSize"];this.tableOptions=n;this.currentPageIndex=0;this.setPageQueryClause(0)};TableQueryWrapper.prototype.sendAndDraw=function(){this.query.abort();var e=this.sortQueryClause+" "+this.pageQueryClause;this.query.setQuery(e);this.table.setSelection([]);var t=this;this.query.send(function(e){t.handleResponse(e)})};TableQueryWrapper.prototype.handleResponse=function(e){this.currentDataTable=null;if(e.isError()){google.visualization.errors.addError(this.container,e.getMessage(),e.getDetailedMessage(),{showInTooltip:false})}else{this.currentDataTable=e.getDataTable();var t=this.tableOptions;var n=this.currentDataTable.getTableProperties();for(var r in n){if(!t[r]){t[r]=n[r]}}this.table.draw(this.currentDataTable,t)}};TableQueryWrapper.prototype.handleSort=function(e){var t=e["column"];var n=e["ascending"];this.tableOptions["sortColumn"]=t;this.tableOptions["sortAscending"]=n;var r=this.currentDataTable.getColumnId(t);this.sortQueryClause="order by `"+r+(!n?"` desc":"`");this.handlePage({page:0})};TableQueryWrapper.prototype.handlePage=function(e){var t=e["page"];var n=0;if(t!=0){n=this.currentPageIndex+t}if(this.setPageQueryClause(n)){this.sendAndDraw()}};TableQueryWrapper.prototype.setPageQueryClause=function(e){var t=this.pageSize;if(e<0){return false}var n=this.currentDataTable;if(e==this.currentPageIndex+1&&n){if(n.getNumberOfRows()<=t){return false}}this.currentPageIndex=e;var r=this.currentPageIndex*t;this.pageQueryClause="limit "+(t+1)+" offset "+r;return true};TableQueryWrapper.clone=function(e){var t={};for(var n in e){t[n]=e[n]}return t};var easygrid={filterForm:function(e,t){var n=jQuery(t).serialize();this.initTable(e,n)();return false},initTable:function(e,t){return function(){var n=document.getElementById(e+"_div");var r=$.data(n,"grid");console.log(r);var i=new google.visualization.Query(r.url+"?"+t);if(r.loadAll){i.send(function(e){if(e.isError()){alert("Error in query: "+e.getMessage()+" "+e.getDetailedMessage());return}var t=new google.visualization.Table(n);t.draw(e.getDataTable(),null)})}else{i.abort();(new TableQueryWrapper(i,n,r.options)).sendAndDraw()}}}}