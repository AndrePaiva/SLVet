(function(e){"use strict";e.jgrid.extend({editCell:function(t,n,r){return this.each(function(){var i=this,s,o,u,a;if(!i.grid||i.p.cellEdit!==true){return}n=parseInt(n,10);i.p.selrow=i.rows[t].id;if(!i.p.knv){e(i).jqGrid("GridNav")}if(i.p.savedRow.length>0){if(r===true){if(t==i.p.iRow&&n==i.p.iCol){return}}e(i).jqGrid("saveCell",i.p.savedRow[0].id,i.p.savedRow[0].ic)}else{window.setTimeout(function(){e("#"+e.jgrid.jqID(i.p.knv)).attr("tabindex","-1").focus()},0)}a=i.p.colModel[n];s=a.name;if(s==="subgrid"||s==="cb"||s==="rn"){return}u=e("td:eq("+n+")",i.rows[t]);if(a.editable===true&&r===true&&!u.hasClass("not-editable-cell")){if(parseInt(i.p.iCol,10)>=0&&parseInt(i.p.iRow,10)>=0){e("td:eq("+i.p.iCol+")",i.rows[i.p.iRow]).removeClass("edit-cell ui-state-highlight");e(i.rows[i.p.iRow]).removeClass("selected-row ui-state-hover")}e(u).addClass("edit-cell ui-state-highlight");e(i.rows[t]).addClass("selected-row ui-state-hover");try{o=e.unformat.call(i,u,{rowId:i.rows[t].id,colModel:a},n)}catch(f){o=a.edittype&&a.edittype==="textarea"?e(u).text():e(u).html()}if(i.p.autoencode){o=e.jgrid.htmlDecode(o)}if(!a.edittype){a.edittype="text"}i.p.savedRow.push({id:t,ic:n,name:s,v:o});if(o==="&nbsp;"||o==="&#160;"||o.length===1&&o.charCodeAt(0)===160){o=""}if(e.isFunction(i.p.formatCell)){var l=i.p.formatCell.call(i,i.rows[t].id,s,o,t,n);if(l!==undefined){o=l}}e(i).triggerHandler("jqGridBeforeEditCell",[i.rows[t].id,s,o,t,n]);if(e.isFunction(i.p.beforeEditCell)){i.p.beforeEditCell.call(i,i.rows[t].id,s,o,t,n)}var c=e.extend({},a.editoptions||{},{id:t+"_"+s,name:s});var h=e.jgrid.createEl.call(i,a.edittype,c,o,true,e.extend({},e.jgrid.ajaxOptions,i.p.ajaxSelectOptions||{}));e(u).html("").append(h).attr("tabindex","0");e.jgrid.bindEv.call(i,h,c);window.setTimeout(function(){e(h).focus()},0);e("input, select, textarea",u).bind("keydown",function(r){if(r.keyCode===27){if(e("input.hasDatepicker",u).length>0){if(e(".ui-datepicker").is(":hidden")){e(i).jqGrid("restoreCell",t,n)}else{e("input.hasDatepicker",u).datepicker("hide")}}else{e(i).jqGrid("restoreCell",t,n)}}if(r.keyCode===13){e(i).jqGrid("saveCell",t,n);return false}if(r.keyCode===9){if(!i.grid.hDiv.loading){if(r.shiftKey){e(i).jqGrid("prevCell",t,n)}else{e(i).jqGrid("nextCell",t,n)}}else{return false}}r.stopPropagation()});e(i).triggerHandler("jqGridAfterEditCell",[i.rows[t].id,s,o,t,n]);if(e.isFunction(i.p.afterEditCell)){i.p.afterEditCell.call(i,i.rows[t].id,s,o,t,n)}}else{if(parseInt(i.p.iCol,10)>=0&&parseInt(i.p.iRow,10)>=0){e("td:eq("+i.p.iCol+")",i.rows[i.p.iRow]).removeClass("edit-cell ui-state-highlight");e(i.rows[i.p.iRow]).removeClass("selected-row ui-state-hover")}u.addClass("edit-cell ui-state-highlight");e(i.rows[t]).addClass("selected-row ui-state-hover");o=u.html().replace(/\&#160\;/ig,"");e(i).triggerHandler("jqGridSelectCell",[i.rows[t].id,s,o,t,n]);if(e.isFunction(i.p.onSelectCell)){i.p.onSelectCell.call(i,i.rows[t].id,s,o,t,n)}}i.p.iCol=n;i.p.iRow=t})},saveCell:function(t,n){return this.each(function(){var r=this,i;if(!r.grid||r.p.cellEdit!==true){return}if(r.p.savedRow.length>=1){i=0}else{i=null}if(i!==null){var s=e("td:eq("+n+")",r.rows[t]),o,u,a=r.p.colModel[n],f=a.name,l=e.jgrid.jqID(f);switch(a.edittype){case"select":if(!a.editoptions.multiple){o=e("#"+t+"_"+l+" option:selected",r.rows[t]).val();u=e("#"+t+"_"+l+" option:selected",r.rows[t]).text()}else{var c=e("#"+t+"_"+l,r.rows[t]),h=[];o=e(c).val();if(o){o.join(",")}else{o=""}e("option:selected",c).each(function(t,n){h[t]=e(n).text()});u=h.join(",")}if(a.formatter){u=o}break;case"checkbox":var p=["Yes","No"];if(a.editoptions){p=a.editoptions.value.split(":")}o=e("#"+t+"_"+l,r.rows[t]).is(":checked")?p[0]:p[1];u=o;break;case"password":case"text":case"textarea":case"button":o=e("#"+t+"_"+l,r.rows[t]).val();u=o;break;case"custom":try{if(a.editoptions&&e.isFunction(a.editoptions.custom_value)){o=a.editoptions.custom_value.call(r,e(".customelement",s),"get");if(o===undefined){throw"e2"}else{u=o}}else{throw"e1"}}catch(d){if(d==="e1"){e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose)}if(d==="e2"){e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose)}else{e.jgrid.info_dialog(e.jgrid.errors.errcap,d.message,e.jgrid.edit.bClose)}}break}if(u!==r.p.savedRow[i].v){var v=e(r).triggerHandler("jqGridBeforeSaveCell",[r.rows[t].id,f,o,t,n]);if(v){o=v;u=v}if(e.isFunction(r.p.beforeSaveCell)){var m=r.p.beforeSaveCell.call(r,r.rows[t].id,f,o,t,n);if(m){o=m;u=m}}var g=e.jgrid.checkValues.call(r,o,n);if(g[0]===true){var y=e(r).triggerHandler("jqGridBeforeSubmitCell",[r.rows[t].id,f,o,t,n])||{};if(e.isFunction(r.p.beforeSubmitCell)){y=r.p.beforeSubmitCell.call(r,r.rows[t].id,f,o,t,n);if(!y){y={}}}if(e("input.hasDatepicker",s).length>0){e("input.hasDatepicker",s).datepicker("hide")}if(r.p.cellsubmit==="remote"){if(r.p.cellurl){var b={};if(r.p.autoencode){o=e.jgrid.htmlEncode(o)}b[f]=o;var w,E,S;S=r.p.prmNames;w=S.id;E=S.oper;b[w]=e.jgrid.stripPref(r.p.idPrefix,r.rows[t].id);b[E]=S.editoper;b=e.extend(y,b);e("#lui_"+e.jgrid.jqID(r.p.id)).show();r.grid.hDiv.loading=true;e.ajax(e.extend({url:r.p.cellurl,data:e.isFunction(r.p.serializeCellData)?r.p.serializeCellData.call(r,b):b,type:"POST",complete:function(i,a){e("#lui_"+r.p.id).hide();r.grid.hDiv.loading=false;if(a==="success"){var l=e(r).triggerHandler("jqGridAfterSubmitCell",[r,i,b.id,f,o,t,n])||[true,""];if(l[0]===true&&e.isFunction(r.p.afterSubmitCell)){l=r.p.afterSubmitCell.call(r,i,b.id,f,o,t,n)}if(l[0]===true){e(s).empty();e(r).jqGrid("setCell",r.rows[t].id,n,u,false,false,true);e(s).addClass("dirty-cell");e(r.rows[t]).addClass("edited");e(r).triggerHandler("jqGridAfterSaveCell",[r.rows[t].id,f,o,t,n]);if(e.isFunction(r.p.afterSaveCell)){r.p.afterSaveCell.call(r,r.rows[t].id,f,o,t,n)}r.p.savedRow.splice(0,1)}else{e.jgrid.info_dialog(e.jgrid.errors.errcap,l[1],e.jgrid.edit.bClose);e(r).jqGrid("restoreCell",t,n)}}},error:function(i,s,o){e("#lui_"+e.jgrid.jqID(r.p.id)).hide();r.grid.hDiv.loading=false;e(r).triggerHandler("jqGridErrorCell",[i,s,o]);if(e.isFunction(r.p.errorCell)){r.p.errorCell.call(r,i,s,o);e(r).jqGrid("restoreCell",t,n)}else{e.jgrid.info_dialog(e.jgrid.errors.errcap,i.status+" : "+i.statusText+"<br/>"+s,e.jgrid.edit.bClose);e(r).jqGrid("restoreCell",t,n)}}},e.jgrid.ajaxOptions,r.p.ajaxCellOptions||{}))}else{try{e.jgrid.info_dialog(e.jgrid.errors.errcap,e.jgrid.errors.nourl,e.jgrid.edit.bClose);e(r).jqGrid("restoreCell",t,n)}catch(d){}}}if(r.p.cellsubmit==="clientArray"){e(s).empty();e(r).jqGrid("setCell",r.rows[t].id,n,u,false,false,true);e(s).addClass("dirty-cell");e(r.rows[t]).addClass("edited");e(r).triggerHandler("jqGridAfterSaveCell",[r.rows[t].id,f,o,t,n]);if(e.isFunction(r.p.afterSaveCell)){r.p.afterSaveCell.call(r,r.rows[t].id,f,o,t,n)}r.p.savedRow.splice(0,1)}}else{try{window.setTimeout(function(){e.jgrid.info_dialog(e.jgrid.errors.errcap,o+" "+g[1],e.jgrid.edit.bClose)},100);e(r).jqGrid("restoreCell",t,n)}catch(d){}}}else{e(r).jqGrid("restoreCell",t,n)}}window.setTimeout(function(){e("#"+e.jgrid.jqID(r.p.knv)).attr("tabindex","-1").focus()},0)})},restoreCell:function(t,n){return this.each(function(){var r=this,i;if(!r.grid||r.p.cellEdit!==true){return}if(r.p.savedRow.length>=1){i=0}else{i=null}if(i!==null){var s=e("td:eq("+n+")",r.rows[t]);if(e.isFunction(e.fn.datepicker)){try{e("input.hasDatepicker",s).datepicker("hide")}catch(o){}}e(s).empty().attr("tabindex","-1");e(r).jqGrid("setCell",r.rows[t].id,n,r.p.savedRow[i].v,false,false,true);e(r).triggerHandler("jqGridAfterRestoreCell",[r.rows[t].id,r.p.savedRow[i].v,t,n]);if(e.isFunction(r.p.afterRestoreCell)){r.p.afterRestoreCell.call(r,r.rows[t].id,r.p.savedRow[i].v,t,n)}r.p.savedRow.splice(0,1)}window.setTimeout(function(){e("#"+r.p.knv).attr("tabindex","-1").focus()},0)})},nextCell:function(t,n){return this.each(function(){var r=this,i=false,s;if(!r.grid||r.p.cellEdit!==true){return}for(s=n+1;s<r.p.colModel.length;s++){if(r.p.colModel[s].editable===true){i=s;break}}if(i!==false){e(r).jqGrid("editCell",t,i,true)}else{if(r.p.savedRow.length>0){e(r).jqGrid("saveCell",t,n)}}})},prevCell:function(t,n){return this.each(function(){var r=this,i=false,s;if(!r.grid||r.p.cellEdit!==true){return}for(s=n-1;s>=0;s--){if(r.p.colModel[s].editable===true){i=s;break}}if(i!==false){e(r).jqGrid("editCell",t,i,true)}else{if(r.p.savedRow.length>0){e(r).jqGrid("saveCell",t,n)}}})},GridNav:function(){return this.each(function(){function s(n,r,i){if(i.substr(0,1)==="v"){var s=e(t.grid.bDiv)[0].clientHeight,o=e(t.grid.bDiv)[0].scrollTop,u=t.rows[n].offsetTop+t.rows[n].clientHeight,a=t.rows[n].offsetTop;if(i==="vd"){if(u>=s){e(t.grid.bDiv)[0].scrollTop=e(t.grid.bDiv)[0].scrollTop+t.rows[n].clientHeight}}if(i==="vu"){if(a<o){e(t.grid.bDiv)[0].scrollTop=e(t.grid.bDiv)[0].scrollTop-t.rows[n].clientHeight}}}if(i==="h"){var f=e(t.grid.bDiv)[0].clientWidth,l=e(t.grid.bDiv)[0].scrollLeft,c=t.rows[n].cells[r].offsetLeft+t.rows[n].cells[r].clientWidth,h=t.rows[n].cells[r].offsetLeft;if(c>=f+parseInt(l,10)){e(t.grid.bDiv)[0].scrollLeft=e(t.grid.bDiv)[0].scrollLeft+t.rows[n].cells[r].clientWidth}else if(h<l){e(t.grid.bDiv)[0].scrollLeft=e(t.grid.bDiv)[0].scrollLeft-t.rows[n].cells[r].clientWidth}}}function o(e,n){var r,i;if(n==="lft"){r=e+1;for(i=e;i>=0;i--){if(t.p.colModel[i].hidden!==true){r=i;break}}}if(n==="rgt"){r=e-1;for(i=e;i<t.p.colModel.length;i++){if(t.p.colModel[i].hidden!==true){r=i;break}}}return r}var t=this;if(!t.grid||t.p.cellEdit!==true){return}t.p.knv=t.p.id+"_kn";var n=e("<div style='position:fixed;top:0px;width:1px;height:1px;' tabindex='0'><div tabindex='-1' style='width:1px;height:1px;' id='"+t.p.knv+"'></div></div>"),r,i;e(n).insertBefore(t.grid.cDiv);e("#"+t.p.knv).focus().keydown(function(n){i=n.keyCode;if(t.p.direction==="rtl"){if(i===37){i=39}else if(i===39){i=37}}switch(i){case 38:if(t.p.iRow-1>0){s(t.p.iRow-1,t.p.iCol,"vu");e(t).jqGrid("editCell",t.p.iRow-1,t.p.iCol,false)}break;case 40:if(t.p.iRow+1<=t.rows.length-1){s(t.p.iRow+1,t.p.iCol,"vd");e(t).jqGrid("editCell",t.p.iRow+1,t.p.iCol,false)}break;case 37:if(t.p.iCol-1>=0){r=o(t.p.iCol-1,"lft");s(t.p.iRow,r,"h");e(t).jqGrid("editCell",t.p.iRow,r,false)}break;case 39:if(t.p.iCol+1<=t.p.colModel.length-1){r=o(t.p.iCol+1,"rgt");s(t.p.iRow,r,"h");e(t).jqGrid("editCell",t.p.iRow,r,false)}break;case 13:if(parseInt(t.p.iCol,10)>=0&&parseInt(t.p.iRow,10)>=0){e(t).jqGrid("editCell",t.p.iRow,t.p.iCol,true)}break;default:return true}return false})})},getChangedCells:function(t){var n=[];if(!t){t="all"}this.each(function(){var r=this,i;if(!r.grid||r.p.cellEdit!==true){return}e(r.rows).each(function(s){var o={};if(e(this).hasClass("edited")){e("td",this).each(function(n){i=r.p.colModel[n].name;if(i!=="cb"&&i!=="subgrid"){if(t==="dirty"){if(e(this).hasClass("dirty-cell")){try{o[i]=e.unformat.call(r,this,{rowId:r.rows[s].id,colModel:r.p.colModel[n]},n)}catch(u){o[i]=e.jgrid.htmlDecode(e(this).html())}}}else{try{o[i]=e.unformat.call(r,this,{rowId:r.rows[s].id,colModel:r.p.colModel[n]},n)}catch(u){o[i]=e.jgrid.htmlDecode(e(this).html())}}}});o.id=this.id;n.push(o)}})});return n}})})(jQuery)