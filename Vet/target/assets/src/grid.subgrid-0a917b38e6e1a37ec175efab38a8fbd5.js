(function(e){"use strict";e.jgrid.extend({setSubGrid:function(){return this.each(function(){var t=this,n,r,i={plusicon:"ui-icon-plus",minusicon:"ui-icon-minus",openicon:"ui-icon-carat-1-sw",expandOnLoad:false,delayOnLoad:50,selectOnExpand:false,selectOnCollapse:false,reloadOnExpand:true};t.p.subGridOptions=e.extend(i,t.p.subGridOptions||{});t.p.colNames.unshift("");t.p.colModel.unshift({name:"subgrid",width:e.jgrid.cell_width?t.p.subGridWidth+t.p.cellLayout:t.p.subGridWidth,sortable:false,resizable:false,hidedlg:true,search:false,fixed:true});n=t.p.subGridModel;if(n[0]){n[0].align=e.extend([],n[0].align||[]);for(r=0;r<n[0].name.length;r++){n[0].align[r]=n[0].align[r]||"left"}}})},addSubGridCell:function(e,t){var n="",r,i;this.each(function(){n=this.formatCol(e,t);i=this.p.id;r=this.p.subGridOptions.plusicon});return'<td role="gridcell" aria-describedby="'+i+'_subgrid" class="ui-sgcollapsed sgcollapsed" '+n+"><a style='cursor:pointer;'><span class='ui-icon "+r+"'></span></a></td>"},addSubGrid:function(t,n){return this.each(function(){var r=this;if(!r.grid){return}var i=function(t,n,i){var s=e("<td align='"+r.p.subGridModel[0].align[i]+"'></td>").html(n);e(t).append(s)};var s=function(t,n){var s,o,u,a=e("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),f=e("<tr></tr>");for(o=0;o<r.p.subGridModel[0].name.length;o++){s=e("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+r.p.direction+"'></th>");e(s).html(r.p.subGridModel[0].name[o]);e(s).width(r.p.subGridModel[0].width[o]);e(f).append(s)}e(a).append(f);if(t){u=r.p.xmlReader.subgrid;e(u.root+" "+u.row,t).each(function(){f=e("<tr class='ui-widget-content ui-subtblcell'></tr>");if(u.repeatitems===true){e(u.cell,this).each(function(t){i(f,e(this).text()||"&#160;",t)})}else{var t=r.p.subGridModel[0].mapping||r.p.subGridModel[0].name;if(t){for(o=0;o<t.length;o++){i(f,e(t[o],this).text()||"&#160;",o)}}}e(a).append(f)})}var l=e("table:first",r.grid.bDiv).attr("id")+"_";e("#"+e.jgrid.jqID(l+n)).append(a);r.grid.hDiv.loading=false;e("#load_"+e.jgrid.jqID(r.p.id)).hide();return false};var o=function(t,n){var s,o,u,a,f,l,c=e("<table cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>"),h=e("<tr></tr>");for(u=0;u<r.p.subGridModel[0].name.length;u++){s=e("<th class='ui-state-default ui-th-subgrid ui-th-column ui-th-"+r.p.direction+"'></th>");e(s).html(r.p.subGridModel[0].name[u]);e(s).width(r.p.subGridModel[0].width[u]);e(h).append(s)}e(c).append(h);if(t){f=r.p.jsonReader.subgrid;o=e.jgrid.getAccessor(t,f.root);if(o!==undefined){for(u=0;u<o.length;u++){a=o[u];h=e("<tr class='ui-widget-content ui-subtblcell'></tr>");if(f.repeatitems===true){if(f.cell){a=a[f.cell]}for(l=0;l<a.length;l++){i(h,a[l]||"&#160;",l)}}else{var p=r.p.subGridModel[0].mapping||r.p.subGridModel[0].name;if(p.length){for(l=0;l<p.length;l++){i(h,a[p[l]]||"&#160;",l)}}}e(c).append(h)}}}var d=e("table:first",r.grid.bDiv).attr("id")+"_";e("#"+e.jgrid.jqID(d+n)).append(c);r.grid.hDiv.loading=false;e("#load_"+e.jgrid.jqID(r.p.id)).hide();return false};var u=function(t){var n,i,u,a;n=e(t).attr("id");i={nd_:(new Date).getTime()};i[r.p.prmNames.subgridid]=n;if(!r.p.subGridModel[0]){return false}if(r.p.subGridModel[0].params){for(a=0;a<r.p.subGridModel[0].params.length;a++){for(u=0;u<r.p.colModel.length;u++){if(r.p.colModel[u].name===r.p.subGridModel[0].params[a]){i[r.p.colModel[u].name]=e("td:eq("+u+")",t).text().replace(/\&#160\;/ig,"")}}}}if(!r.grid.hDiv.loading){r.grid.hDiv.loading=true;e("#load_"+e.jgrid.jqID(r.p.id)).show();if(!r.p.subgridtype){r.p.subgridtype=r.p.datatype}if(e.isFunction(r.p.subgridtype)){r.p.subgridtype.call(r,i)}else{r.p.subgridtype=r.p.subgridtype.toLowerCase()}switch(r.p.subgridtype){case"xml":case"json":e.ajax(e.extend({type:r.p.mtype,url:r.p.subGridUrl,dataType:r.p.subgridtype,data:e.isFunction(r.p.serializeSubGridData)?r.p.serializeSubGridData.call(r,i):i,complete:function(t){if(r.p.subgridtype==="xml"){s(t.responseXML,n)}else{o(e.jgrid.parse(t.responseText),n)}t=null}},e.jgrid.ajaxOptions,r.p.ajaxSubgridOptions||{}));break}}return false};var a,f,l,c=0,h,p;e.each(r.p.colModel,function(){if(this.hidden===true||this.name==="rn"||this.name==="cb"){c++}});var d=r.rows.length,v=1;if(n!==undefined&&n>0){v=n;d=n+1}while(v<d){if(e(r.rows[v]).hasClass("jqgrow")){e(r.rows[v].cells[t]).bind("click",function(){var n=e(this).parent("tr")[0];p=n.nextSibling;if(e(this).hasClass("sgcollapsed")){f=r.p.id;a=n.id;if(r.p.subGridOptions.reloadOnExpand===true||r.p.subGridOptions.reloadOnExpand===false&&!e(p).hasClass("ui-subgrid")){l=t>=1?"<td colspan='"+t+"'>&#160;</td>":"";h=e(r).triggerHandler("jqGridSubGridBeforeExpand",[f+"_"+a,a]);h=h===false||h==="stop"?false:true;if(h&&e.isFunction(r.p.subGridBeforeExpand)){h=r.p.subGridBeforeExpand.call(r,f+"_"+a,a)}if(h===false){return false}e(n).after("<tr role='row' class='ui-subgrid'>"+l+"<td class='ui-widget-content subgrid-cell'><span class='ui-icon "+r.p.subGridOptions.openicon+"'></span></td><td colspan='"+parseInt(r.p.colNames.length-1-c,10)+"' class='ui-widget-content subgrid-data'><div id="+f+"_"+a+" class='tablediv'></div></td></tr>");e(r).triggerHandler("jqGridSubGridRowExpanded",[f+"_"+a,a]);if(e.isFunction(r.p.subGridRowExpanded)){r.p.subGridRowExpanded.call(r,f+"_"+a,a)}else{u(n)}}else{e(p).show()}e(this).html("<a style='cursor:pointer;'><span class='ui-icon "+r.p.subGridOptions.minusicon+"'></span></a>").removeClass("sgcollapsed").addClass("sgexpanded");if(r.p.subGridOptions.selectOnExpand){e(r).jqGrid("setSelection",a)}}else if(e(this).hasClass("sgexpanded")){h=e(r).triggerHandler("jqGridSubGridRowColapsed",[f+"_"+a,a]);h=h===false||h==="stop"?false:true;a=n.id;if(h&&e.isFunction(r.p.subGridRowColapsed)){h=r.p.subGridRowColapsed.call(r,f+"_"+a,a)}if(h===false){return false}if(r.p.subGridOptions.reloadOnExpand===true){e(p).remove(".ui-subgrid")}else if(e(p).hasClass("ui-subgrid")){e(p).hide()}e(this).html("<a style='cursor:pointer;'><span class='ui-icon "+r.p.subGridOptions.plusicon+"'></span></a>").removeClass("sgexpanded").addClass("sgcollapsed");if(r.p.subGridOptions.selectOnCollapse){e(r).jqGrid("setSelection",a)}}return false})}v++}if(r.p.subGridOptions.expandOnLoad===true){e(r.rows).filter(".jqgrow").each(function(t,n){e(n.cells[0]).click()})}r.subGridXml=function(e,t){s(e,t)};r.subGridJson=function(e,t){o(e,t)}})},expandSubGridRow:function(t){return this.each(function(){var n=this;if(!n.grid&&!t){return}if(n.p.subGrid===true){var r=e(this).jqGrid("getInd",t,true);if(r){var i=e("td.sgcollapsed",r)[0];if(i){e(i).trigger("click")}}}})},collapseSubGridRow:function(t){return this.each(function(){var n=this;if(!n.grid&&!t){return}if(n.p.subGrid===true){var r=e(this).jqGrid("getInd",t,true);if(r){var i=e("td.sgexpanded",r)[0];if(i){e(i).trigger("click")}}}})},toggleSubGridRow:function(t){return this.each(function(){var n=this;if(!n.grid&&!t){return}if(n.p.subGrid===true){var r=e(this).jqGrid("getInd",t,true);if(r){var i=e("td.sgcollapsed",r)[0];if(i){e(i).trigger("click")}else{i=e("td.sgexpanded",r)[0];if(i){e(i).trigger("click")}}}}})}})})(jQuery)