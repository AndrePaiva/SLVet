(function(e){"use strict";function t(e,t){var n,r,i=[],s;if(!this||typeof e!=="function"||e instanceof RegExp){throw new TypeError}s=this.length;for(n=0;n<s;n++){if(this.hasOwnProperty(n)){r=this[n];if(e.call(t,r,n,this)){i.push(r);break}}}return i}e.assocArraySize=function(e){var t=0,n;for(n in e){if(e.hasOwnProperty(n)){t++}}return t};e.jgrid.extend({pivotSetup:function(n,r){var i=[],s=[],o=[],u=[],a={grouping:true,groupingView:{groupField:[],groupSummary:[],groupSummaryPos:[]}},f=[],l=e.extend({rowTotals:false,rowTotalsText:"Total",colTotals:false,groupSummary:true,groupSummaryPos:"header",frozenStaticCols:false},r||{});this.each(function(){function w(e,n,r){var i;i=t.call(e,n,r);return i.length>0?i[0]:null}function E(e,t){var n=0,r=true,i;for(i in e){if(e[i]!=this[n]){r=false;break}n++;if(n>=this.length){break}}if(r){c=t}return r}function S(e,t,n,r){var i;switch(e){case"sum":i=parseFloat(t||0)+parseFloat(r[n]||0);break;case"count":if(t===""||t==null){t=0}if(r.hasOwnProperty(n)){i=t+1}else{i=0}break;case"min":if(t===""||t==null){i=parseFloat(r[n]||0)}else{i=Math.min(parseFloat(t),parseFloat(r[n]||0))}break;case"max":if(t===""||t==null){i=parseFloat(r[n]||0)}else{i=Math.max(parseFloat(t),parseFloat(r[n]||0))}break}return i}function x(t,n,r,i){var s=n.length,o,a,f,l;if(e.isArray(r)){l=r.length}else{l=1}u=[];u.root=0;for(f=0;f<l;f++){var c=[],h;for(o=0;o<s;o++){if(r==null){a=e.trim(n[o].member)+"_"+n[o].aggregator;h=a}else{h=r[f].replace(/\s+/g,"");try{a=s===1?h:h+"_"+n[o].aggregator+"_"+o}catch(p){}}i[a]=c[a]=S(n[o].aggregator,i[a],n[o].member,t)}u[h]=c}return i}function F(e){var t,n,r,s,o;for(r in e){if(e.hasOwnProperty(r)){if(typeof e[r]!=="object"){if(r==="level"){if(H[e.level]===undefined){H[e.level]="";if(e.level>0&&e.text!=="_r_Totals"){f[e.level-1]={useColSpanStyle:false,groupHeaders:[]}}}if(H[e.level]!==e.text&&e.children.length&&e.text!=="_r_Totals"){if(e.level>0){f[e.level-1].groupHeaders.push({titleText:e.text});var u=f[e.level-1].groupHeaders.length,a=u===1?j:B+(u-1)*m;f[e.level-1].groupHeaders[u-1].startColumnName=i[a].name;f[e.level-1].groupHeaders[u-1].numberOfColumns=i.length-a;B=i.length}}H[e.level]=e.text}if(e.level===v&&r==="level"&&v>0){if(m>1){var c=1;for(t in e.fields){if(c===1){f[v-1].groupHeaders.push({startColumnName:t,numberOfColumns:1,titleText:e.text})}c++}f[v-1].groupHeaders[f[v-1].groupHeaders.length-1].numberOfColumns=c-1}else{f.splice(v-1,1)}}}if(e[r]!=null&&typeof e[r]==="object"){F(e[r])}if(r==="level"){if(e.level>0){n=0;for(t in e.fields){o={};for(s in l.aggregates[n]){if(l.aggregates[n].hasOwnProperty(s)){switch(s){case"member":case"label":case"aggregator":break;default:o[s]=l.aggregates[n][s]}}}if(m>1){o.name=t;o.label=l.aggregates[n].label||t}else{o.name=e.text;o.label=e.text==="_r_Totals"?l.rowTotalsText:e.text}i.push(o);n++}}}}}}var r,c,h,p=n.length,d,v,m,g,y,b=0;if(l.rowTotals&&l.yDimension.length>0){var T=l.yDimension[0].dataName;l.yDimension.splice(0,0,{dataName:T});l.yDimension[0].converter=function(){return"_r_Totals"}}d=e.isArray(l.xDimension)?l.xDimension.length:0;v=l.yDimension.length;m=e.isArray(l.aggregates)?l.aggregates.length:0;if(d===0||m===0){throw"xDimension or aggregates optiona are not set!"}var N;for(h=0;h<d;h++){N={name:l.xDimension[h].dataName,frozen:l.frozenStaticCols};N=e.extend(true,N,l.xDimension[h]);i.push(N)}var C=d-1,k={};while(b<p){r=n[b];var L=[];var A=[];g={};h=0;do{L[h]=e.trim(r[l.xDimension[h].dataName]);g[l.xDimension[h].dataName]=L[h];h++}while(h<d);var O=0;c=-1;y=w(s,E,L);if(!y){O=0;if(v>=1){for(O=0;O<v;O++){A[O]=e.trim(r[l.yDimension[O].dataName]);if(l.yDimension[O].converter&&e.isFunction(l.yDimension[O].converter)){A[O]=l.yDimension[O].converter.call(this,A[O],L,A)}}g=x(r,l.aggregates,A,g)}else if(v===0){g=x(r,l.aggregates,null,g)}s.push(g)}else{if(c>=0){O=0;if(v>=1){for(O=0;O<v;O++){A[O]=e.trim(r[l.yDimension[O].dataName]);if(l.yDimension[O].converter&&e.isFunction(l.yDimension[O].converter)){A[O]=l.yDimension[O].converter.call(this,A[O],L,A)}}y=x(r,l.aggregates,A,y)}else if(v===0){y=x(r,l.aggregates,null,y)}s[c]=y}}var M=0,_=null,D=null,P;for(P in u){if(M===0){if(!k.children||k.children===undefined){k={text:P,level:0,children:[]}}_=k.children}else{D=null;for(h=0;h<_.length;h++){if(_[h].text===P){D=_[h];break}}if(D){_=D.children}else{_.push({children:[],text:P,level:M,fields:u[P]});_=_[_.length-1].children}}M++}b++}var H=[],B=i.length,j=B;if(v>0){f[v-1]={useColSpanStyle:false,groupHeaders:[]}}F(k,0);var I;if(l.colTotals){var q=s.length;while(q--){for(h=d;h<i.length;h++){I=i[h].name;if(!o[I]){o[I]=parseFloat(s[q][I]||0)}else{o[I]+=parseFloat(s[q][I]||0)}}}}if(C>0){for(h=0;h<C;h++){a.groupingView.groupField[h]=i[h].name;a.groupingView.groupSummary[h]=l.groupSummary;a.groupingView.groupSummaryPos[h]=l.groupSummaryPos}}else{a.grouping=false}a.sortname=i[C].name;a.groupingView.hideFirstGroupCol=true});return{colModel:i,rows:s,groupOptions:a,groupHeaders:f,summary:o}},jqPivot:function(t,n,r,i){return this.each(function(){function o(t){var i=jQuery(s).jqGrid("pivotSetup",t,n),o=e.assocArraySize(i.summary)>0?true:false,u=e.jgrid.from(i.rows),a;for(a=0;a<i.groupOptions.groupingView.groupField.length;a++){u.orderBy(i.groupOptions.groupingView.groupField[a],"a","text","")}jQuery(s).jqGrid(e.extend({datastr:e.extend(u.select(),o?{userdata:i.summary}:{}),datatype:"jsonstring",footerrow:o,userDataOnFooter:o,colModel:i.colModel,viewrecords:true,sortname:n.xDimension[0].dataName},r||{},i.groupOptions));var f=i.groupHeaders;if(f.length){for(a=0;a<f.length;a++){if(f[a]&&f[a].groupHeaders.length){jQuery(s).jqGrid("setGroupHeaders",f[a])}}}if(n.frozenStaticCols){jQuery(s).jqGrid("setFrozenColumns")}}var s=this;if(typeof t==="string"){e.ajax(e.extend({url:t,dataType:"json",success:function(t){o(e.jgrid.getAccessor(t,i&&i.reader?i.reader:"rows"))}},i||{}))}else{o(t)}})}})})(jQuery)