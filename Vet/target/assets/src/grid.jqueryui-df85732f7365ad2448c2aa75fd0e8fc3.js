(function($){"use strict";if($.jgrid.msie&&$.jgrid.msiever()===8){$.expr[":"].hidden=function(e){return e.offsetWidth===0||e.offsetHeight===0||e.style.display==="none"}}$.jgrid._multiselect=false;if($.ui){if($.ui.multiselect){if($.ui.multiselect.prototype._setSelected){var setSelected=$.ui.multiselect.prototype._setSelected;$.ui.multiselect.prototype._setSelected=function(e,t){var n=setSelected.call(this,e,t);if(t&&this.selectedList){var r=this.element;this.selectedList.find("li").each(function(){if($(this).data("optionLink")){$(this).data("optionLink").remove().appendTo(r)}})}return n}}if($.ui.multiselect.prototype.destroy){$.ui.multiselect.prototype.destroy=function(){this.element.show();this.container.remove();if($.Widget===undefined){$.widget.prototype.destroy.apply(this,arguments)}else{$.Widget.prototype.destroy.apply(this,arguments)}}}$.jgrid._multiselect=true}}$.jgrid.extend({sortableColumns:function(e){return this.each(function(){function r(){t.p.disableClick=true}var t=this,n=$.jgrid.jqID(t.p.id);var i={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+n+"_cb"+",#jqgh_"+n+"_rn"+",#jqgh_"+n+"_subgrid),:hidden)",placeholder:{element:function(e){var t=$(document.createElement(e[0].nodeName)).addClass(e[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0];return t},update:function(e,t){t.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10));t.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10))}},update:function(e,n){var r=$(n.item).parent(),i=$(">th",r),s=t.p.colModel,o={},u=t.p.id+"_";$.each(s,function(e){o[this.name]=e});var a=[];i.each(function(){var e=$(">div",this).get(0).id.replace(/^jqgh_/,"").replace(u,"");if(o.hasOwnProperty(e)){a.push(o[e])}});$(t).jqGrid("remapColumns",a,true,true);if($.isFunction(t.p.sortable.update)){t.p.sortable.update(a)}setTimeout(function(){t.p.disableClick=false},50)}};if(t.p.sortable.options){$.extend(i,t.p.sortable.options)}else if($.isFunction(t.p.sortable)){t.p.sortable={update:t.p.sortable}}if(i.start){var s=i.start;i.start=function(e,t){r();s.call(this,e,t)}}else{i.start=r}if(t.p.sortable.exclude){i.items+=":not("+t.p.sortable.exclude+")"}e.sortable(i).data("sortable").floating=true})},columnChooser:function(e){function i(e,t,n){if(t>=0){var r=e.slice();var i=r.splice(t,Math.max(e.length-t,t));if(t>e.length){t=e.length}r[t]=n;return r.concat(i)}}function f(e,t){if(!e){return}if(typeof e==="string"){if($.fn[e]){$.fn[e].apply(t,$.makeArray(arguments).slice(2))}}else if($.isFunction(e)){e.apply(t,$.makeArray(arguments).slice(2))}}var t=this;if($("#colchooser_"+$.jgrid.jqID(t[0].p.id)).length){return}var n=$('<div id="colchooser_'+t[0].p.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>');var r=$("select",n);e=$.extend({width:420,height:240,classname:null,done:function(e){if(e){t.jqGrid("remapColumns",e,true)}},msel:"multiselect",dlog:"dialog",dialog_opts:{minWidth:470},dlog_opts:function(e){var t={};t[e.bSubmit]=function(){e.apply_perm();e.cleanup(false)};t[e.bCancel]=function(){e.cleanup(true)};return $.extend(true,{buttons:t,close:function(){e.cleanup(true)},modal:e.modal||false,resizable:e.resizable||true,width:e.width+20},e.dialog_opts||{})},apply_perm:function(){$("option",r).each(function(){if(this.selected){t.jqGrid("showCol",s[this.value].name)}else{t.jqGrid("hideCol",s[this.value].name)}});var n=[];$("option:selected",r).each(function(){n.push(parseInt(this.value,10))});$.each(n,function(){delete u[s[parseInt(this,10)].name]});$.each(u,function(){var e=parseInt(this,10);n=i(n,e,e)});if(e.done){e.done.call(t,n)}},cleanup:function(i){f(e.dlog,n,"destroy");f(e.msel,r,"destroy");n.remove();if(i&&e.done){e.done.call(t)}},msel_opts:{}},$.jgrid.col,e||{});if($.ui){if($.ui.multiselect){if(e.msel==="multiselect"){if(!$.jgrid._multiselect){alert("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");return}e.msel_opts=$.extend($.ui.multiselect.defaults,e.msel_opts)}}}if(e.caption){n.attr("title",e.caption)}if(e.classname){n.addClass(e.classname);r.addClass(e.classname)}if(e.width){$(">div",n).css({width:e.width,margin:"0 auto"});r.css("width",e.width)}if(e.height){$(">div",n).css("height",e.height);r.css("height",e.height-10)}var s=t.jqGrid("getGridParam","colModel");var o=t.jqGrid("getGridParam","colNames");var u={},a=[];r.empty();$.each(s,function(e){u[this.name]=e;if(this.hidedlg){if(!this.hidden){a.push(e)}return}r.append("<option value='"+e+"' "+(this.hidden?"":"selected='selected'")+">"+$.jgrid.stripHtml(o[e])+"</option>")});var l=$.isFunction(e.dlog_opts)?e.dlog_opts.call(t,e):e.dlog_opts;f(e.dlog,n,l);var c=$.isFunction(e.msel_opts)?e.msel_opts.call(t,e):e.msel_opts;f(e.msel,r,c)},sortableRows:function(e){return this.each(function(){var t=this;if(!t.grid){return}if(t.p.treeGrid){return}if($.fn.sortable){e=$.extend({cursor:"move",axis:"y",items:".jqgrow"},e||{});if(e.start&&$.isFunction(e.start)){e._start_=e.start;delete e.start}else{e._start_=false}if(e.update&&$.isFunction(e.update)){e._update_=e.update;delete e.update}else{e._update_=false}e.start=function(n,r){$(r.item).css("border-width","0");$("td",r.item).each(function(e){this.style.width=t.grid.cols[e].style.width});if(t.p.subGrid){var i=$(r.item).attr("id");try{$(t).jqGrid("collapseSubGridRow",i)}catch(s){}}if(e._start_){e._start_.apply(this,[n,r])}};e.update=function(n,r){$(r.item).css("border-width","");if(t.p.rownumbers===true){$("td.jqgrid-rownum",t.rows).each(function(e){$(this).html(e+1+(parseInt(t.p.page,10)-1)*parseInt(t.p.rowNum,10))})}if(e._update_){e._update_.apply(this,[n,r])}};$("tbody:first",t).sortable(e);$("tbody:first",t).disableSelection()}})},gridDnD:function(e){return this.each(function(){function i(){var e=$.data(t,"dnd");$("tr.jqgrow:not(.ui-draggable)",t).draggable($.isFunction(e.drag)?e.drag.call($(t),e):e.drag)}var t=this,n,r;if(!t.grid){return}if(t.p.treeGrid){return}if(!$.fn.draggable||!$.fn.droppable){return}var s="<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>";if($("#jqgrid_dnd")[0]===undefined){$("body").append(s)}if(typeof e==="string"&&e==="updateDnD"&&t.p.jqgdnd===true){i();return}e=$.extend({drag:function(e){return $.extend({start:function(n,r){var i,s;if(t.p.subGrid){s=$(r.helper).attr("id");try{$(t).jqGrid("collapseSubGridRow",s)}catch(o){}}for(i=0;i<$.data(t,"dnd").connectWith.length;i++){if($($.data(t,"dnd").connectWith[i]).jqGrid("getGridParam","reccount")===0){$($.data(t,"dnd").connectWith[i]).jqGrid("addRowData","jqg_empty_row",{})}}r.helper.addClass("ui-state-highlight");$("td",r.helper).each(function(e){this.style.width=t.grid.headers[e].width+"px"});if(e.onstart&&$.isFunction(e.onstart)){e.onstart.call($(t),n,r)}},stop:function(n,r){var i,s;if(r.helper.dropped&&!e.dragcopy){s=$(r.helper).attr("id");if(s===undefined){s=$(this).attr("id")}$(t).jqGrid("delRowData",s)}for(i=0;i<$.data(t,"dnd").connectWith.length;i++){$($.data(t,"dnd").connectWith[i]).jqGrid("delRowData","jqg_empty_row")}if(e.onstop&&$.isFunction(e.onstop)){e.onstop.call($(t),n,r)}}},e.drag_opts||{})},drop:function(e){return $.extend({accept:function(e){if(!$(e).hasClass("jqgrow")){return e}var t=$(e).closest("table.ui-jqgrid-btable");if(t.length>0&&$.data(t[0],"dnd")!==undefined){var n=$.data(t[0],"dnd").connectWith;return $.inArray("#"+$.jgrid.jqID(this.id),n)!==-1?true:false}return false},drop:function(n,r){if(!$(r.draggable).hasClass("jqgrow")){return}var i=$(r.draggable).attr("id");var s=r.draggable.parent().parent().jqGrid("getRowData",i);if(!e.dropbyname){var o=0,u={},a,f;var l=$("#"+$.jgrid.jqID(this.id)).jqGrid("getGridParam","colModel");try{for(f in s){if(s.hasOwnProperty(f)){a=l[o].name;if(!(a==="cb"||a==="rn"||a==="subgrid")){if(s.hasOwnProperty(f)&&l[o]){u[a]=s[f]}}o++}}s=u}catch(c){}}r.helper.dropped=true;if(e.beforedrop&&$.isFunction(e.beforedrop)){var h=e.beforedrop.call(this,n,r,s,$("#"+$.jgrid.jqID(t.p.id)),$(this));if(h!==undefined&&h!==null&&typeof h==="object"){s=h}}if(r.helper.dropped){var p;if(e.autoid){if($.isFunction(e.autoid)){p=e.autoid.call(this,s)}else{p=Math.ceil(Math.random()*1e3);p=e.autoidprefix+p}}$("#"+$.jgrid.jqID(this.id)).jqGrid("addRowData",p,s,e.droppos)}if(e.ondrop&&$.isFunction(e.ondrop)){e.ondrop.call(this,n,r,s)}}},e.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{activeClass:"ui-state-active",hoverClass:"ui-state-hover"},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:false,dropbyname:false,droppos:"first",autoid:true,autoidprefix:"dnd_"},e||{});if(!e.connectWith){return}e.connectWith=e.connectWith.split(",");e.connectWith=$.map(e.connectWith,function(e){return $.trim(e)});$.data(t,"dnd",e);if(t.p.reccount!==0&&!t.p.jqgdnd){i()}t.p.jqgdnd=true;for(n=0;n<e.connectWith.length;n++){r=e.connectWith[n];$(r).droppable($.isFunction(e.drop)?e.drop.call($(t),e):e.drop)}})},gridResize:function(opts){return this.each(function(){var $t=this,gID=$.jgrid.jqID($t.p.id);if(!$t.grid||!$.fn.resizable){return}opts=$.extend({},opts||{});if(opts.alsoResize){opts._alsoResize_=opts.alsoResize;delete opts.alsoResize}else{opts._alsoResize_=false}if(opts.stop&&$.isFunction(opts.stop)){opts._stop_=opts.stop;delete opts.stop}else{opts._stop_=false}opts.stop=function(e,t){$($t).jqGrid("setGridParam",{height:$("#gview_"+gID+" .ui-jqgrid-bdiv").height()});$($t).jqGrid("setGridWidth",t.size.width,opts.shrinkToFit);if(opts._stop_){opts._stop_.call($t,e,t)}};if(opts._alsoResize_){var optstest="{'#gview_"+gID+" .ui-jqgrid-bdiv':true,'"+opts._alsoResize_+"':true}";opts.alsoResize=eval("("+optstest+")")}else{opts.alsoResize=$(".ui-jqgrid-bdiv","#gview_"+gID)}delete opts._alsoResize_;$("#gbox_"+gID).resizable(opts)})}})})(jQuery)