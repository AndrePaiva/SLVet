(function(e){"use strict";e.extend(e.jgrid,{template:function(t){var n=e.makeArray(arguments).slice(1),r,i=n.length;if(t==null){t=""}return t.replace(/\{([\w\-]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g,function(t,s){if(!isNaN(parseInt(s,10))){return n[parseInt(s,10)]}for(r=0;r<i;r++){if(e.isArray(n[r])){var o=n[r],u=o.length;while(u--){if(s===o[u].nm){return o[u].v}}}}})}});e.jgrid.extend({groupingSetup:function(){return this.each(function(){var t=this,n,r,i,s=t.p.colModel,o=t.p.groupingView;if(o!==null&&(typeof o==="object"||e.isFunction(o))){if(!o.groupField.length){t.p.grouping=false}else{if(o.visibiltyOnNextGrouping===undefined){o.visibiltyOnNextGrouping=[]}o.lastvalues=[];if(!o._locgr){o.groups=[]}o.counters=[];for(n=0;n<o.groupField.length;n++){if(!o.groupOrder[n]){o.groupOrder[n]="asc"}if(!o.groupText[n]){o.groupText[n]="{0}"}if(typeof o.groupColumnShow[n]!=="boolean"){o.groupColumnShow[n]=true}if(typeof o.groupSummary[n]!=="boolean"){o.groupSummary[n]=false}if(!o.groupSummaryPos[n]){o.groupSummaryPos[n]="footer"}if(o.groupColumnShow[n]===true){o.visibiltyOnNextGrouping[n]=true;e(t).jqGrid("showCol",o.groupField[n])}else{o.visibiltyOnNextGrouping[n]=e("#"+e.jgrid.jqID(t.p.id+"_"+o.groupField[n])).is(":visible");e(t).jqGrid("hideCol",o.groupField[n])}}o.summary=[];if(o.hideFirstGroupCol){o.formatDisplayField[0]=function(e){return e}}for(r=0,i=s.length;r<i;r++){if(o.hideFirstGroupCol){if(!s[r].hidden&&o.groupField[0]===s[r].name){s[r].formatter=function(){return""}}}if(s[r].summaryType){if(s[r].summaryDivider){o.summary.push({nm:s[r].name,st:s[r].summaryType,v:"",sd:s[r].summaryDivider,vd:"",sr:s[r].summaryRound,srt:s[r].summaryRoundType||"round"})}else{o.summary.push({nm:s[r].name,st:s[r].summaryType,v:"",sr:s[r].summaryRound,srt:s[r].summaryRoundType||"round"})}}}}}else{t.p.grouping=false}})},groupingPrepare:function(t,n){this.each(function(){var r=this.p.groupingView,i=this,s,o=r.groupField.length,u,a,f,l,c=0;for(s=0;s<o;s++){u=r.groupField[s];f=r.displayField[s];a=t[u];l=f==null?null:t[f];if(l==null){l=a}if(a!==undefined){if(n===0){r.groups.push({idx:s,dataIndex:u,value:a,displayValue:l,startRow:n,cnt:1,summary:[]});r.lastvalues[s]=a;r.counters[s]={cnt:1,pos:r.groups.length-1,summary:e.extend(true,[],r.summary)};e.each(r.counters[s].summary,function(){if(e.isFunction(this.st)){this.v=this.st.call(i,this.v,this.nm,t)}else{this.v=e(i).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,t);if(this.st.toLowerCase()==="avg"&&this.sd){this.vd=e(i).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,t)}}});r.groups[r.counters[s].pos].summary=r.counters[s].summary}else{if(typeof a!=="object"&&(e.isArray(r.isInTheSameGroup)&&e.isFunction(r.isInTheSameGroup[s])?!r.isInTheSameGroup[s].call(i,r.lastvalues[s],a,s,r):r.lastvalues[s]!==a)){r.groups.push({idx:s,dataIndex:u,value:a,displayValue:l,startRow:n,cnt:1,summary:[]});r.lastvalues[s]=a;c=1;r.counters[s]={cnt:1,pos:r.groups.length-1,summary:e.extend(true,[],r.summary)};e.each(r.counters[s].summary,function(){if(e.isFunction(this.st)){this.v=this.st.call(i,this.v,this.nm,t)}else{this.v=e(i).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,t);if(this.st.toLowerCase()==="avg"&&this.sd){this.vd=e(i).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,t)}}});r.groups[r.counters[s].pos].summary=r.counters[s].summary}else{if(c===1){r.groups.push({idx:s,dataIndex:u,value:a,displayValue:l,startRow:n,cnt:1,summary:[]});r.lastvalues[s]=a;r.counters[s]={cnt:1,pos:r.groups.length-1,summary:e.extend(true,[],r.summary)};e.each(r.counters[s].summary,function(){if(e.isFunction(this.st)){this.v=this.st.call(i,this.v,this.nm,t)}else{this.v=e(i).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,t);if(this.st.toLowerCase()==="avg"&&this.sd){this.vd=e(i).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,t)}}});r.groups[r.counters[s].pos].summary=r.counters[s].summary}else{r.counters[s].cnt+=1;r.groups[r.counters[s].pos].cnt=r.counters[s].cnt;e.each(r.counters[s].summary,function(){if(e.isFunction(this.st)){this.v=this.st.call(i,this.v,this.nm,t)}else{this.v=e(i).jqGrid("groupingCalculations.handler",this.st,this.v,this.nm,this.sr,this.srt,t);if(this.st.toLowerCase()==="avg"&&this.sd){this.vd=e(i).jqGrid("groupingCalculations.handler",this.st,this.vd,this.sd,this.sr,this.srt,t)}}});r.groups[r.counters[s].pos].summary=r.counters[s].summary}}}}}});return this},groupingToggle:function(t){this.each(function(){var n=this,r=n.p.groupingView,i=t.split("_"),s=parseInt(i[i.length-2],10);i.splice(i.length-2,2);var o=i.join("_"),u=r.minusicon,a=r.plusicon,f=e("#"+e.jgrid.jqID(t)),l=f.length?f[0].nextSibling:null,c=e("#"+e.jgrid.jqID(t)+" span."+"tree-wrap-"+n.p.direction),h=function(t){var n=e.map(t.split(" "),function(e){if(e.substring(0,o.length+1)===o+"_"){return parseInt(e.substring(o.length+1),10)}});return n.length>0?n[0]:undefined},p,d,v=false,m=n.p.frozenColumns?n.p.id+"_frozen":false,g=m?e("#"+e.jgrid.jqID(t),"#"+e.jgrid.jqID(m)):false,y=g&&g.length?g[0].nextSibling:null;if(c.hasClass(u)){if(r.showSummaryOnHide){if(l){while(l){if(e(l).hasClass("jqfoot")){var b=parseInt(e(l).attr("jqfootlevel"),10);if(b<=s){break}}e(l).hide();l=l.nextSibling;if(m){e(y).hide();y=y.nextSibling}}}}else{if(l){while(l){p=h(l.className);if(p!==undefined&&p<=s){break}e(l).hide();l=l.nextSibling;if(m){e(y).hide();y=y.nextSibling}}}}c.removeClass(u).addClass(a);v=true}else{if(l){d=undefined;while(l){p=h(l.className);if(d===undefined){d=p===undefined}if(p!==undefined){if(p<=s){break}if(p===s+1){e(l).show().find(">td>span."+"tree-wrap-"+n.p.direction).removeClass(u).addClass(a);if(m){e(y).show().find(">td>span."+"tree-wrap-"+n.p.direction).removeClass(u).addClass(a)}}}else if(d){e(l).show();if(m){e(y).show()}}l=l.nextSibling;if(m){y=y.nextSibling}}}c.removeClass(a).addClass(u)}e(n).triggerHandler("jqGridGroupingClickGroup",[t,v]);if(e.isFunction(n.p.onClickGroup)){n.p.onClickGroup.call(n,t,v)}});return false},groupingRender:function(t,n,r,i){return this.each(function(){function m(e,t,n){var r=false,i;if(t===0){r=n[e]}else{var s=n[e].idx;if(s===0){r=n[e]}else{for(i=e;i>=0;i--){if(n[i].idx===s-t){r=n[i];break}}}}return r}function g(t,r,i,o){var u=m(t,r,i),a=s.p.colModel,f,l=u.cnt,c="",h;for(h=o;h<n;h++){var p="<td "+s.formatCol(h,1,"")+">&#160;</td>",d="{0}";e.each(u.summary,function(){if(this.nm===a[h].name){if(a[h].summaryTpl){d=a[h].summaryTpl}if(typeof this.st==="string"&&this.st.toLowerCase()==="avg"){if(this.sd&&this.vd){this.v=this.v/this.vd}else if(this.v&&l>0){this.v=this.v/l}}try{this.groupCount=u.cnt;this.groupIndex=u.dataIndex;this.groupValue=u.value;f=s.formatter("",this.v,h,this)}catch(t){f=this.v}p="<td "+s.formatCol(h,1,"")+">"+e.jgrid.format(d,f)+"</td>";return false}});c+=p}return c}var s=this,o=s.p.groupingView,u="",a="",f,l,c=o.groupCollapse?o.plusicon:o.minusicon,h,p=[],d=o.groupField.length;c+=" tree-wrap-"+s.p.direction;e.each(s.p.colModel,function(e,t){var n;for(n=0;n<d;n++){if(o.groupField[n]===t.name){p[n]=e;break}}});var v=0;var y=e.makeArray(o.groupSummary);y.reverse();e.each(o.groups,function(m,b){if(o._locgr){if(!(b.startRow+b.cnt>(r-1)*i&&b.startRow<r*i)){return true}}v++;l=s.p.id+"ghead_"+b.idx;f=l+"_"+m;a="<span style='cursor:pointer;' class='ui-icon "+c+"' onclick=\"jQuery('#"+e.jgrid.jqID(s.p.id)+"').jqGrid('groupingToggle','"+f+"');return false;\"></span>";try{if(e.isArray(o.formatDisplayField)&&e.isFunction(o.formatDisplayField[b.idx])){b.displayValue=o.formatDisplayField[b.idx].call(s,b.displayValue,b.value,s.p.colModel[p[b.idx]],b.idx,o);h=b.displayValue}else{h=s.formatter(f,b.displayValue,p[b.idx],b.value)}}catch(w){h=b.displayValue}if(o.groupSummaryPos[b.idx]==="header"){u+='<tr id="'+f+'"'+(o.groupCollapse&&b.idx>0?' style="display:none;" ':" ")+'role="row" class= "ui-widget-content jqgroup ui-row-'+s.p.direction+" "+l+'"><td style="padding-left:'+b.idx*12+"px;"+'">'+a+e.jgrid.template(o.groupText[b.idx],h,b.cnt,b.summary)+"</td>";u+=g(m,b.idx-1,o.groups,1);u+="</tr>"}else{u+='<tr id="'+f+'"'+(o.groupCollapse&&b.idx>0?' style="display:none;" ':" ")+'role="row" class= "ui-widget-content jqgroup ui-row-'+s.p.direction+" "+l+'"><td style="padding-left:'+b.idx*12+"px;"+'" colspan="'+n+'">'+a+e.jgrid.template(o.groupText[b.idx],h,b.cnt,b.summary)+"</td></tr>"}var E=d-1===b.idx;if(E){var S=o.groups[m+1],x,T,N=0,C=b.startRow,k=S!==undefined?o.groups[m+1].startRow:t.length;if(o._locgr){N=(r-1)*i;if(N>b.startRow){C=N}}for(x=C;x<k;x++){if(!t[x-N]){break}u+=t[x-N].join("")}if(o.groupSummaryPos[b.idx]!=="header"){var L;if(S!==undefined){for(L=0;L<o.groupField.length;L++){if(S.dataIndex===o.groupField[L]){break}}v=o.groupField.length-L}for(T=0;T<v;T++){if(!y[T]){continue}var A="";if(o.groupCollapse&&!o.showSummaryOnHide){A=' style="display:none;"'}u+="<tr"+A+' jqfootlevel="'+(b.idx-T)+'" role="row" class="ui-widget-content jqfoot ui-row-'+s.p.direction+'">';u+=g(m,T,o.groups,0);u+="</tr>"}v=L}}});e("#"+e.jgrid.jqID(s.p.id)+" tbody:first").append(u);u=null})},groupingGroupBy:function(t,n){return this.each(function(){var r=this;if(typeof t==="string"){t=[t]}var i=r.p.groupingView;r.p.grouping=true;if(i.visibiltyOnNextGrouping===undefined){i.visibiltyOnNextGrouping=[]}var s;for(s=0;s<i.groupField.length;s++){if(!i.groupColumnShow[s]&&i.visibiltyOnNextGrouping[s]){e(r).jqGrid("showCol",i.groupField[s])}}for(s=0;s<t.length;s++){i.visibiltyOnNextGrouping[s]=e("#"+e.jgrid.jqID(r.p.id)+"_"+e.jgrid.jqID(t[s])).is(":visible")}r.p.groupingView=e.extend(r.p.groupingView,n||{});i.groupField=t;e(r).trigger("reloadGrid")})},groupingRemove:function(t){return this.each(function(){var n=this;if(t===undefined){t=true}n.p.grouping=false;if(t===true){var r=n.p.groupingView,i;for(i=0;i<r.groupField.length;i++){if(!r.groupColumnShow[i]&&r.visibiltyOnNextGrouping[i]){e(n).jqGrid("showCol",r.groupField)}}e("tr.jqgroup, tr.jqfoot","#"+e.jgrid.jqID(n.p.id)+" tbody:first").remove();e("tr.jqgrow:hidden","#"+e.jgrid.jqID(n.p.id)+" tbody:first").show()}else{e(n).trigger("reloadGrid")}})},groupingCalculations:{handler:function(e,t,n,r,i,s){var o={sum:function(){return parseFloat(t||0)+parseFloat(s[n]||0)},min:function(){if(t===""){return parseFloat(s[n]||0)}return Math.min(parseFloat(t),parseFloat(s[n]||0))},max:function(){if(t===""){return parseFloat(s[n]||0)}return Math.max(parseFloat(t),parseFloat(s[n]||0))},count:function(){if(t===""){t=0}if(s.hasOwnProperty(n)){return t+1}return 0},avg:function(){return o.sum()}};if(!o[e]){throw"jqGrid Grouping No such method: "+e}var u=o[e]();if(r!=null){if(i==="fixed"){u=u.toFixed(r)}else{var a=Math.pow(10,r);u=Math.round(u*a)/a}}return u}}})})(jQuery)