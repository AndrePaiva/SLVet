(function(e){"use strict";e.jgrid.extend({jqGridImport:function(t){t=e.extend({imptype:"xml",impstring:"",impurl:"",mtype:"GET",impData:{},xmlGrid:{config:"roots>grid",data:"roots>rows"},jsonGrid:{config:"grid",data:"data"},ajaxOptions:{}},t||{});return this.each(function(){var n=this;var r=function(t,r){var i=e(r.xmlGrid.config,t)[0];var s=e(r.xmlGrid.data,t)[0],o,u,a;if(xmlJsonClass.xml2json&&e.jgrid.parse){o=xmlJsonClass.xml2json(i," ");o=e.jgrid.parse(o);for(a in o){if(o.hasOwnProperty(a)){u=o[a]}}if(s){var f=o.grid.datatype;o.grid.datatype="xmlstring";o.grid.datastr=t;e(n).jqGrid(u).jqGrid("setGridParam",{datatype:f})}else{e(n).jqGrid(u)}o=null;u=null}else{alert("xml2json or parse are not present")}};var i=function(t,r){if(t&&typeof t==="string"){var i=false;if(e.jgrid.useJSON){e.jgrid.useJSON=false;i=true}var s=e.jgrid.parse(t);if(i){e.jgrid.useJSON=true}var o=s[r.jsonGrid.config];var u=s[r.jsonGrid.data];if(u){var a=o.datatype;o.datatype="jsonstring";o.datastr=u;e(n).jqGrid(o).jqGrid("setGridParam",{datatype:a})}else{e(n).jqGrid(o)}}};switch(t.imptype){case"xml":e.ajax(e.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"xml",complete:function(i,s){if(s==="success"){r(i.responseXML,t);e(n).triggerHandler("jqGridImportComplete",[i,t]);if(e.isFunction(t.importComplete)){t.importComplete(i)}}i=null}},t.ajaxOptions));break;case"xmlstring":if(t.impstring&&typeof t.impstring==="string"){var s=e.parseXML(t.impstring);if(s){r(s,t);e(n).triggerHandler("jqGridImportComplete",[s,t]);if(e.isFunction(t.importComplete)){t.importComplete(s)}t.impstring=null}s=null}break;case"json":e.ajax(e.extend({url:t.impurl,type:t.mtype,data:t.impData,dataType:"json",complete:function(r){try{i(r.responseText,t);e(n).triggerHandler("jqGridImportComplete",[r,t]);if(e.isFunction(t.importComplete)){t.importComplete(r)}}catch(s){}r=null}},t.ajaxOptions));break;case"jsonstring":if(t.impstring&&typeof t.impstring==="string"){i(t.impstring,t);e(n).triggerHandler("jqGridImportComplete",[t.impstring,t]);if(e.isFunction(t.importComplete)){t.importComplete(t.impstring)}t.impstring=null}break}})},jqGridExport:function(t){t=e.extend({exptype:"xmlstring",root:"grid",ident:"	"},t||{});var n=null;this.each(function(){if(!this.grid){return}var r,i=e.extend(true,{},e(this).jqGrid("getGridParam"));if(i.rownumbers){i.colNames.splice(0,1);i.colModel.splice(0,1)}if(i.multiselect){i.colNames.splice(0,1);i.colModel.splice(0,1)}if(i.subGrid){i.colNames.splice(0,1);i.colModel.splice(0,1)}i.knv=null;if(i.treeGrid){for(r in i.treeReader){if(i.treeReader.hasOwnProperty(r)){i.colNames.splice(i.colNames.length-1);i.colModel.splice(i.colModel.length-1)}}}switch(t.exptype){case"xmlstring":n="<"+t.root+">"+xmlJsonClass.json2xml(i,t.ident)+"</"+t.root+">";break;case"jsonstring":n="{"+xmlJsonClass.toJson(i,t.root,t.ident,false)+"}";if(i.postData.filters!==undefined){n=n.replace(/filters":"/,'filters":');n=n.replace(/}]}"/,"}]}")}break}});return n},excelExport:function(t){t=e.extend({exptype:"remote",url:null,oper:"oper",tag:"excel",exportOptions:{}},t||{});return this.each(function(){if(!this.grid){return}var n;if(t.exptype==="remote"){var r=e.extend({},this.p.postData);r[t.oper]=t.tag;var i=jQuery.param(r);if(t.url.indexOf("?")!==-1){n=t.url+"&"+i}else{n=t.url+"?"+i}window.location=n}})}})})(jQuery)