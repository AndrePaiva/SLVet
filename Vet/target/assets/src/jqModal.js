(function(e){e.fn.jqm=function(r){var s={overlay:50,closeoverlay:true,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:i,ajaxText:"",target:i,modal:i,toTop:i,onShow:i,onHide:i,onLoad:i};return this.each(function(){if(this._jqm)return n[this._jqm].c=e.extend({},n[this._jqm].c,r);t++;this._jqm=t;n[t]={c:e.extend(s,e.jqm.params,r),a:i,w:e(this).addClass("jqmID"+t),s:t};if(s.trigger)e(this).jqmAddTrigger(s.trigger)})};e.fn.jqmAddClose=function(e){return f(this,e,"jqmHide")};e.fn.jqmAddTrigger=function(e){return f(this,e,"jqmShow")};e.fn.jqmShow=function(t){return this.each(function(){e.jqm.open(this._jqm,t)})};e.fn.jqmHide=function(t){return this.each(function(){e.jqm.close(this._jqm,t)})};e.jqm={hash:{},open:function(t,o){var a=n[t],f=a.c,l="."+f.closeClass,c=parseInt(a.w.css("z-index"));c=c>0?c:3e3;var h=e("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":c-1,opacity:f.overlay/100});if(a.a)return i;a.t=o;a.a=true;a.w.css("z-index",c);if(f.modal){if(!r[0])setTimeout(function(){u("bind")},1);r.push(t)}else if(f.overlay>0){if(f.closeoverlay)a.w.jqmAddClose(h)}else h=i;a.o=h?h.addClass(f.overlayClass).prependTo("body"):i;if(f.ajax){var p=f.target||a.w,d=f.ajax;p=typeof p=="string"?e(p,a.w):e(p);d=d.substr(0,1)=="@"?e(o).attr(d.substring(1)):d;p.html(f.ajaxText).load(d,function(){if(f.onLoad)f.onLoad.call(this,a);if(l)a.w.jqmAddClose(e(l,a.w));s(a)})}else if(l)a.w.jqmAddClose(e(l,a.w));if(f.toTop&&a.o)a.w.before('<span id="jqmP'+a.w[0]._jqm+'"></span>').insertAfter(a.o);f.onShow?f.onShow(a):a.w.show();s(a);return i},close:function(t){var s=n[t];if(!s.a)return i;s.a=i;if(r[0]){r.pop();if(!r[0])u("unbind")}if(s.c.toTop&&s.o)e("#jqmP"+s.w[0]._jqm).after(s.w).remove();if(s.c.onHide)s.c.onHide(s);else{s.w.hide();if(s.o)s.o.remove()}return i},params:{}};var t=0,n=e.jqm.hash,r=[],i=false,s=function(e){o(e)},o=function(t){try{e(":input:visible",t.w)[0].focus()}catch(n){}},u=function(t){e(document)[t]("keypress",a)[t]("keydown",a)[t]("mousedown",a)},a=function(t){var i=n[r[r.length-1]],s=!e(t.target).parents(".jqmID"+i.s)[0];if(s){e(".jqmID"+i.s).each(function(){var n=e(this),r=n.offset();if(r.top<=t.pageY&&t.pageY<=r.top+n.height()&&r.left<=t.pageX&&t.pageX<=r.left+n.width()){s=false;return false}});o(i)}return!s},f=function(t,r,s){return t.each(function(){var t=this._jqm;e(r).each(function(){if(!this[s]){this[s]=[];e(this).click(function(){for(var e in{jqmShow:1,jqmHide:1})for(var t in this[e])if(n[this[e][t]])n[this[e][t]].w[e](this);return i})}this[s].push(t)})})}})(jQuery)