(function(e){"use strict";e.jgrid.inlineEdit=e.jgrid.inlineEdit||{};e.jgrid.extend({editRow:function(t,n,r,i,s,o,u,a,f){var l={},c=e.makeArray(arguments).slice(1);if(e.type(c[0])==="object"){l=c[0]}else{if(n!==undefined){l.keys=n}if(e.isFunction(r)){l.oneditfunc=r}if(e.isFunction(i)){l.successfunc=i}if(s!==undefined){l.url=s}if(o!==undefined){l.extraparam=o}if(e.isFunction(u)){l.aftersavefunc=u}if(e.isFunction(a)){l.errorfunc=a}if(e.isFunction(f)){l.afterrestorefunc=f}}l=e.extend(true,{keys:false,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:true,mtype:"POST"},e.jgrid.inlineEdit,l);return this.each(function(){var n=this,r,i,s,o=0,u=null,a={},f,c,h;if(!n.grid){return}f=e(n).jqGrid("getInd",t,true);if(f===false){return}h=e.isFunction(l.beforeEditRow)?l.beforeEditRow.call(n,l,t):undefined;if(h===undefined){h=true}if(!h){return}s=e(f).attr("editable")||"0";if(s==="0"&&!e(f).hasClass("not-editable-row")){c=n.p.colModel;e('td[role="gridcell"]',f).each(function(s){r=c[s].name;var f=n.p.treeGrid===true&&r===n.p.ExpandColumn;if(f){i=e("span:first",this).html()}else{try{i=e.unformat.call(n,this,{rowId:t,colModel:c[s]},s)}catch(l){i=c[s].edittype&&c[s].edittype==="textarea"?e(this).text():e(this).html()}}if(r!=="cb"&&r!=="subgrid"&&r!=="rn"){if(n.p.autoencode){i=e.jgrid.htmlDecode(i)}a[r]=i;if(c[s].editable===true){if(u===null){u=s}if(f){e("span:first",this).html("")}else{e(this).html("")}var h=e.extend({},c[s].editoptions||{},{id:t+"_"+r,name:r});if(!c[s].edittype){c[s].edittype="text"}if(i==="&nbsp;"||i==="&#160;"||i.length===1&&i.charCodeAt(0)===160){i=""}var p=e.jgrid.createEl.call(n,c[s].edittype,h,i,true,e.extend({},e.jgrid.ajaxOptions,n.p.ajaxSelectOptions||{}));e(p).addClass("editable");if(f){e("span:first",this).append(p)}else{e(this).append(p)}e.jgrid.bindEv.call(n,p,h);if(c[s].edittype==="select"&&c[s].editoptions!==undefined&&c[s].editoptions.multiple===true&&c[s].editoptions.dataUrl===undefined&&e.jgrid.msie){e(p).width(e(p).width())}o++}}});if(o>0){a.id=t;n.p.savedRow.push(a);e(f).attr("editable","1");setTimeout(function(){e("td:eq("+u+") input",f).focus()},0);if(l.keys===true){e(f).bind("keydown",function(r){if(r.keyCode===27){e(n).jqGrid("restoreRow",t,l.afterrestorefunc);if(n.p._inlinenav){try{e(n).jqGrid("showAddEditButtons")}catch(i){}}return false}if(r.keyCode===13){var s=r.target;if(s.tagName==="TEXTAREA"){return true}if(e(n).jqGrid("saveRow",t,l)){if(n.p._inlinenav){try{e(n).jqGrid("showAddEditButtons")}catch(o){}}}return false}})}e(n).triggerHandler("jqGridInlineEditRow",[t,l]);if(e.isFunction(l.oneditfunc)){l.oneditfunc.call(n,t)}}}})},saveRow:function(t,n,r,i,s,o,u){var a=e.makeArray(arguments).slice(1),f={};if(e.type(a[0])==="object"){f=a[0]}else{if(e.isFunction(n)){f.successfunc=n}if(r!==undefined){f.url=r}if(i!==undefined){f.extraparam=i}if(e.isFunction(s)){f.aftersavefunc=s}if(e.isFunction(o)){f.errorfunc=o}if(e.isFunction(u)){f.afterrestorefunc=u}}f=e.extend(true,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:true,mtype:"POST"},e.jgrid.inlineEdit,f);var l=false;var c=this[0],h,p={},d={},v={},m,g,y,b;if(!c.grid){return l}b=e(c).jqGrid("getInd",t,true);if(b===false){return l}var w=e.isFunction(f.beforeSaveRow)?f.beforeSaveRow.call(c,f,t):undefined;if(w===undefined){w=true}if(!w){return}m=e(b).attr("editable");f.url=f.url||c.p.editurl;if(m==="1"){var E;e('td[role="gridcell"]',b).each(function(t){E=c.p.colModel[t];h=E.name;if(h!=="cb"&&h!=="subgrid"&&E.editable===true&&h!=="rn"&&!e(this).hasClass("not-editable-cell")){switch(E.edittype){case"checkbox":var n=["Yes","No"];if(E.editoptions){n=E.editoptions.value.split(":")}p[h]=e("input",this).is(":checked")?n[0]:n[1];break;case"text":case"password":case"textarea":case"button":p[h]=e("input, textarea",this).val();break;case"select":if(!E.editoptions.multiple){p[h]=e("select option:selected",this).val();d[h]=e("select option:selected",this).text()}else{var r=e("select",this),i=[];p[h]=e(r).val();if(p[h]){p[h]=p[h].join(",")}else{p[h]=""}e("select option:selected",this).each(function(t,n){i[t]=e(n).text()});d[h]=i.join(",")}if(E.formatter&&E.formatter==="select"){d={}}break;case"custom":try{if(E.editoptions&&e.isFunction(E.editoptions.custom_value)){p[h]=E.editoptions.custom_value.call(c,e(".customelement",this),"get");if(p[h]===undefined){throw"e2"}}else{throw"e1"}}catch(s){if(s==="e1"){e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose)}if(s==="e2"){e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_value' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose)}else{e.jgrid.info_dialog(e.jgrid.errors.errcap,s.message,e.jgrid.edit.bClose)}}break}y=e.jgrid.checkValues.call(c,p[h],t);if(y[0]===false){return false}if(c.p.autoencode){p[h]=e.jgrid.htmlEncode(p[h])}if(f.url!=="clientArray"&&E.editoptions&&E.editoptions.NullIfEmpty===true){if(p[h]===""){v[h]="null"}}}});if(y[0]===false){try{var S=e(c).jqGrid("getGridRowById",t),x=e.jgrid.findPos(S);e.jgrid.info_dialog(e.jgrid.errors.errcap,y[1],e.jgrid.edit.bClose,{left:x[0],top:x[1]+e(S).outerHeight()})}catch(T){alert(y[1])}return l}var N,C=c.p.prmNames,k=t;if(c.p.keyIndex===false){N=C.id}else{N=c.p.colModel[c.p.keyIndex+(c.p.rownumbers===true?1:0)+(c.p.multiselect===true?1:0)+(c.p.subGrid===true?1:0)].name}if(p){p[C.oper]=C.editoper;if(p[N]===undefined||p[N]===""){p[N]=t}else if(b.id!==c.p.idPrefix+p[N]){var L=e.jgrid.stripPref(c.p.idPrefix,t);if(c.p._index[L]!==undefined){c.p._index[p[N]]=c.p._index[L];delete c.p._index[L]}t=c.p.idPrefix+p[N];e(b).attr("id",t);if(c.p.selrow===k){c.p.selrow=t}if(e.isArray(c.p.selarrrow)){var A=e.inArray(k,c.p.selarrrow);if(A>=0){c.p.selarrrow[A]=t}}if(c.p.multiselect){var O="jqg_"+c.p.id+"_"+t;e("input.cbox",b).attr("id",O).attr("name",O)}}if(c.p.inlineData===undefined){c.p.inlineData={}}p=e.extend({},p,c.p.inlineData,f.extraparam)}if(f.url==="clientArray"){p=e.extend({},p,d);if(c.p.autoencode){e.each(p,function(t,n){p[t]=e.jgrid.htmlDecode(n)})}var M,_=e(c).jqGrid("setRowData",t,p);e(b).attr("editable","0");for(M=0;M<c.p.savedRow.length;M++){if(String(c.p.savedRow[M].id)===String(k)){g=M;break}}if(g>=0){c.p.savedRow.splice(g,1)}e(c).triggerHandler("jqGridInlineAfterSaveRow",[t,_,p,f]);if(e.isFunction(f.aftersavefunc)){f.aftersavefunc.call(c,t,_,f)}l=true;e(b).removeClass("jqgrid-new-row").unbind("keydown")}else{e("#lui_"+e.jgrid.jqID(c.p.id)).show();v=e.extend({},p,v);v[N]=e.jgrid.stripPref(c.p.idPrefix,v[N]);e.ajax(e.extend({url:f.url,data:e.isFunction(c.p.serializeRowData)?c.p.serializeRowData.call(c,v):v,type:f.mtype,async:false,complete:function(n,r){e("#lui_"+e.jgrid.jqID(c.p.id)).hide();if(r==="success"){var i=true,s,o;s=e(c).triggerHandler("jqGridInlineSuccessSaveRow",[n,t,f]);if(!e.isArray(s)){s=[true,p]}if(s[0]&&e.isFunction(f.successfunc)){s=f.successfunc.call(c,n)}if(e.isArray(s)){i=s[0];p=s[1]||p}else{i=s}if(i===true){if(c.p.autoencode){e.each(p,function(t,n){p[t]=e.jgrid.htmlDecode(n)})}p=e.extend({},p,d);e(c).jqGrid("setRowData",t,p);e(b).attr("editable","0");for(o=0;o<c.p.savedRow.length;o++){if(String(c.p.savedRow[o].id)===String(t)){g=o;break}}if(g>=0){c.p.savedRow.splice(g,1)}e(c).triggerHandler("jqGridInlineAfterSaveRow",[t,n,p,f]);if(e.isFunction(f.aftersavefunc)){f.aftersavefunc.call(c,t,n)}l=true;e(b).removeClass("jqgrid-new-row").unbind("keydown")}else{e(c).triggerHandler("jqGridInlineErrorSaveRow",[t,n,r,null,f]);if(e.isFunction(f.errorfunc)){f.errorfunc.call(c,t,n,r,null)}if(f.restoreAfterError===true){e(c).jqGrid("restoreRow",t,f.afterrestorefunc)}}}},error:function(n,r,i){e("#lui_"+e.jgrid.jqID(c.p.id)).hide();e(c).triggerHandler("jqGridInlineErrorSaveRow",[t,n,r,i,f]);if(e.isFunction(f.errorfunc)){f.errorfunc.call(c,t,n,r,i)}else{var s=n.responseText||n.statusText;try{e.jgrid.info_dialog(e.jgrid.errors.errcap,'<div class="ui-state-error">'+s+"</div>",e.jgrid.edit.bClose,{buttonalign:"right"})}catch(o){alert(s)}}if(f.restoreAfterError===true){e(c).jqGrid("restoreRow",t,f.afterrestorefunc)}}},e.jgrid.ajaxOptions,c.p.ajaxRowOptions||{}))}}return l},restoreRow:function(t,n){var r=e.makeArray(arguments).slice(1),i={};if(e.type(r[0])==="object"){i=r[0]}else{if(e.isFunction(n)){i.afterrestorefunc=n}}i=e.extend(true,{},e.jgrid.inlineEdit,i);return this.each(function(){var n=this,r=-1,s,u={},a;if(!n.grid){return}s=e(n).jqGrid("getInd",t,true);if(s===false){return}var f=e.isFunction(i.beforeCancelRow)?i.beforeCancelRow.call(n,i,sr):undefined;if(f===undefined){f=true}if(!f){return}for(a=0;a<n.p.savedRow.length;a++){if(String(n.p.savedRow[a].id)===String(t)){r=a;break}}if(r>=0){if(e.isFunction(e.fn.datepicker)){try{e("input.hasDatepicker","#"+e.jgrid.jqID(s.id)).datepicker("hide")}catch(l){}}e.each(n.p.colModel,function(){if(this.editable===true&&n.p.savedRow[r].hasOwnProperty(this.name)){u[this.name]=n.p.savedRow[r][this.name]}});e(n).jqGrid("setRowData",t,u);e(s).attr("editable","0").unbind("keydown");n.p.savedRow.splice(r,1);if(e("#"+e.jgrid.jqID(t),"#"+e.jgrid.jqID(n.p.id)).hasClass("jqgrid-new-row")){setTimeout(function(){e(n).jqGrid("delRowData",t);e(n).jqGrid("showAddEditButtons")},0)}}e(n).triggerHandler("jqGridInlineAfterRestoreRow",[t]);if(e.isFunction(i.afterrestorefunc)){i.afterrestorefunc.call(n,t)}})},addRow:function(t){t=e.extend(true,{rowID:null,initdata:{},position:"first",useDefValues:true,useFormatter:false,addRowParams:{extraparam:{}}},t||{});return this.each(function(){if(!this.grid){return}var n=this;var r=e.isFunction(t.beforeAddRow)?t.beforeAddRow.call(n,t.addRowParams):undefined;if(r===undefined){r=true}if(!r){return}t.rowID=e.isFunction(t.rowID)?t.rowID.call(n,t):t.rowID!=null?t.rowID:e.jgrid.randId();if(t.useDefValues===true){e(n.p.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var r=this.editoptions.defaultValue,i=e.isFunction(r)?r.call(n):r;t.initdata[this.name]=i}})}e(n).jqGrid("addRowData",t.rowID,t.initdata,t.position);t.rowID=n.p.idPrefix+t.rowID;e("#"+e.jgrid.jqID(t.rowID),"#"+e.jgrid.jqID(n.p.id)).addClass("jqgrid-new-row");if(t.useFormatter){e("#"+e.jgrid.jqID(t.rowID)+" .ui-inline-edit","#"+e.jgrid.jqID(n.p.id)).click()}else{var i=n.p.prmNames,s=i.oper;t.addRowParams.extraparam[s]=i.addoper;e(n).jqGrid("editRow",t.rowID,t.addRowParams);e(n).jqGrid("setSelection",t.rowID)}})},inlineNav:function(t,n){n=e.extend(true,{edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",save:true,saveicon:"ui-icon-disk",cancel:true,cancelicon:"ui-icon-cancel",addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:true},e.jgrid.nav,n||{});return this.each(function(){if(!this.grid){return}var r=this,i,s=e.jgrid.jqID(r.p.id);r.p._inlinenav=true;if(n.addParams.useFormatter===true){var u=r.p.colModel,a;for(a=0;a<u.length;a++){if(u[a].formatter&&u[a].formatter==="actions"){if(u[a].formatoptions){var f={keys:false,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},l=e.extend(f,u[a].formatoptions);n.addParams.addRowParams={keys:l.keys,oneditfunc:l.onEdit,successfunc:l.onSuccess,url:l.url,extraparam:l.extraparam,aftersavefunc:l.afterSave,errorfunc:l.onError,afterrestorefunc:l.afterRestore}}break}}}if(n.add){e(r).jqGrid("navButtonAdd",t,{caption:n.addtext,title:n.addtitle,buttonicon:n.addicon,id:r.p.id+"_iladd",onClickButton:function(){e(r).jqGrid("addRow",n.addParams);if(!n.addParams.useFormatter){e("#"+s+"_ilsave").removeClass("ui-state-disabled");e("#"+s+"_ilcancel").removeClass("ui-state-disabled");e("#"+s+"_iladd").addClass("ui-state-disabled");e("#"+s+"_iledit").addClass("ui-state-disabled")}}})}if(n.edit){e(r).jqGrid("navButtonAdd",t,{caption:n.edittext,title:n.edittitle,buttonicon:n.editicon,id:r.p.id+"_iledit",onClickButton:function(){var t=e(r).jqGrid("getGridParam","selrow");if(t){e(r).jqGrid("editRow",t,n.editParams);e("#"+s+"_ilsave").removeClass("ui-state-disabled");e("#"+s+"_ilcancel").removeClass("ui-state-disabled");e("#"+s+"_iladd").addClass("ui-state-disabled");e("#"+s+"_iledit").addClass("ui-state-disabled")}else{e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+s,jqm:true});e("#jqg_alrt").focus()}}})}if(n.save){e(r).jqGrid("navButtonAdd",t,{caption:n.savetext||"",title:n.savetitle||"Save row",buttonicon:n.saveicon,id:r.p.id+"_ilsave",onClickButton:function(){var t=r.p.savedRow[0].id;if(t){var i=r.p.prmNames,u=i.oper,a=n.editParams;if(e("#"+e.jgrid.jqID(t),"#"+s).hasClass("jqgrid-new-row")){n.addParams.addRowParams.extraparam[u]=i.addoper;a=n.addParams.addRowParams}else{if(!n.editParams.extraparam){n.editParams.extraparam={}}n.editParams.extraparam[u]=i.editoper}if(e(r).jqGrid("saveRow",t,a)){e(r).jqGrid("showAddEditButtons")}}else{e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+s,jqm:true});e("#jqg_alrt").focus()}}});e("#"+s+"_ilsave").addClass("ui-state-disabled")}if(n.cancel){e(r).jqGrid("navButtonAdd",t,{caption:n.canceltext||"",title:n.canceltitle||"Cancel row editing",buttonicon:n.cancelicon,id:r.p.id+"_ilcancel",onClickButton:function(){var t=r.p.savedRow[0].id,i=n.editParams;if(t){if(e("#"+e.jgrid.jqID(t),"#"+s).hasClass("jqgrid-new-row")){i=n.addParams.addRowParams}e(r).jqGrid("restoreRow",t,i);e(r).jqGrid("showAddEditButtons")}else{e.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+s,jqm:true});e("#jqg_alrt").focus()}}});e("#"+s+"_ilcancel").addClass("ui-state-disabled")}if(n.restoreAfterSelect===true){if(e.isFunction(r.p.beforeSelectRow)){i=r.p.beforeSelectRow}else{i=false}r.p.beforeSelectRow=function(t,s){var u=true;if(r.p.savedRow.length>0&&r.p._inlinenav===true&&t!==r.p.selrow&&r.p.selrow!==null){if(r.p.selrow===n.addParams.rowID){e(r).jqGrid("delRowData",r.p.selrow)}else{e(r).jqGrid("restoreRow",r.p.selrow,n.editParams)}e(r).jqGrid("showAddEditButtons")}if(i){u=i.call(r,t,s)}return u}}})},showAddEditButtons:function(){return this.each(function(){if(!this.grid){return}var t=e.jgrid.jqID(this.p.id);e("#"+t+"_ilsave").addClass("ui-state-disabled");e("#"+t+"_ilcancel").addClass("ui-state-disabled");e("#"+t+"_iladd").removeClass("ui-state-disabled");e("#"+t+"_iledit").removeClass("ui-state-disabled")})}})})(jQuery)