(function(e){"use strict";e.extend(e.jgrid,{showModal:function(e){e.w.show()},closeModal:function(e){e.w.hide().attr("aria-hidden","true");if(e.o){e.o.remove()}},hideModal:function(t,n){n=e.extend({jqm:true,gb:""},n||{});if(n.onClose){var r=n.gb&&typeof n.gb==="string"&&n.gb.substr(0,6)==="#gbox_"?n.onClose.call(e("#"+n.gb.substr(6))[0],t):n.onClose(t);if(typeof r==="boolean"&&!r){return}}if(e.fn.jqm&&n.jqm===true){e(t).attr("aria-hidden","true").jqmHide()}else{if(n.gb!==""){try{e(".jqgrid-overlay:first",n.gb).hide()}catch(i){}}e(t).hide().attr("aria-hidden","true")}},findPos:function(e){var t=0,n=0;if(e.offsetParent){do{t+=e.offsetLeft;n+=e.offsetTop}while(e=e.offsetParent)}return[t,n]},createModal:function(t,n,r,i,s,o,u){r=e.extend(true,{},e.jgrid.jqModal||{},r);var a=document.createElement("div"),f,l=this;u=e.extend({},u||{});f=e(r.gbox).attr("dir")==="rtl"?true:false;a.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog";a.id=t.themodal;var c=document.createElement("div");c.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix";c.id=t.modalhead;e(c).append("<span class='ui-jqdialog-title'>"+r.caption+"</span>");var h=e("<a class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){h.addClass("ui-state-hover")},function(){h.removeClass("ui-state-hover")}).append("<span class='ui-icon ui-icon-closethick'></span>");e(c).append(h);if(f){a.dir="rtl";e(".ui-jqdialog-title",c).css("float","right");e(".ui-jqdialog-titlebar-close",c).css("left",.3+"em")}else{a.dir="ltr";e(".ui-jqdialog-title",c).css("float","left");e(".ui-jqdialog-titlebar-close",c).css("right",.3+"em")}var p=document.createElement("div");e(p).addClass("ui-jqdialog-content ui-widget-content").attr("id",t.modalcontent);e(p).append(n);a.appendChild(p);e(a).prepend(c);if(o===true){e("body").append(a)}else if(typeof o==="string"){e(o).append(a)}else{e(a).insertBefore(i)}e(a).css(u);if(r.jqModal===undefined){r.jqModal=true}var d={};if(e.fn.jqm&&r.jqModal===true){if(r.left===0&&r.top===0&&r.overlay){var v=[];v=e.jgrid.findPos(s);r.left=v[0]+4;r.top=v[1]+4}d.top=r.top+"px";d.left=r.left}else if(r.left!==0||r.top!==0){d.left=r.left;d.top=r.top+"px"}e("a.ui-jqdialog-titlebar-close",c).click(function(){var n=e("#"+e.jgrid.jqID(t.themodal)).data("onClose")||r.onClose;var i=e("#"+e.jgrid.jqID(t.themodal)).data("gbox")||r.gbox;l.hideModal("#"+e.jgrid.jqID(t.themodal),{gb:i,jqm:r.jqModal,onClose:n});return false});if(r.width===0||!r.width){r.width=300}if(r.height===0||!r.height){r.height=200}if(!r.zIndex){var m=e(i).parents("*[role=dialog]").filter(":first").css("z-index");if(m){r.zIndex=parseInt(m,10)+2}else{r.zIndex=950}}var g=0;if(f&&d.left&&!o){g=e(r.gbox).width()-(!isNaN(r.width)?parseInt(r.width,10):0)-8;d.left=parseInt(d.left,10)+parseInt(g,10)}if(d.left){d.left+="px"}e(a).css(e.extend({width:isNaN(r.width)?"auto":r.width+"px",height:isNaN(r.height)?"auto":r.height+"px",zIndex:r.zIndex,overflow:"hidden"},d)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":t.modalhead,"aria-hidden":"true"});if(r.drag===undefined){r.drag=true}if(r.resize===undefined){r.resize=true}if(r.drag){e(c).css("cursor","move");if(e.fn.jqDrag){e(a).jqDrag(c)}else{try{e(a).draggable({handle:e("#"+e.jgrid.jqID(c.id))})}catch(y){}}}if(r.resize){if(e.fn.jqResize){e(a).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se'></div>");e("#"+e.jgrid.jqID(t.themodal)).jqResize(".jqResize",t.scrollelm?"#"+e.jgrid.jqID(t.scrollelm):false)}else{try{e(a).resizable({handles:"se, sw",alsoResize:t.scrollelm?"#"+e.jgrid.jqID(t.scrollelm):false})}catch(b){}}}if(r.closeOnEscape===true){e(a).keydown(function(n){if(n.which==27){var i=e("#"+e.jgrid.jqID(t.themodal)).data("onClose")||r.onClose;l.hideModal("#"+e.jgrid.jqID(t.themodal),{gb:r.gbox,jqm:r.jqModal,onClose:i})}})}},viewModal:function(t,n){n=e.extend({toTop:true,overlay:10,modal:false,overlayClass:"ui-widget-overlay",onShow:e.jgrid.showModal,onHide:e.jgrid.closeModal,gbox:"",jqm:true,jqM:true},n||{});if(e.fn.jqm&&n.jqm===true){if(n.jqM){e(t).attr("aria-hidden","false").jqm(n).jqmShow()}else{e(t).attr("aria-hidden","false").jqmShow()}}else{if(n.gbox!==""){e(".jqgrid-overlay:first",n.gbox).show();e(t).data("gbox",n.gbox)}e(t).show().attr("aria-hidden","false");try{e(":input:visible",t)[0].focus()}catch(r){}}},info_dialog:function(t,n,r,i){var s={width:290,height:"auto",dataheight:"auto",drag:true,resize:false,left:250,top:170,zIndex:1e3,jqModal:true,modal:false,closeOnEscape:true,align:"center",buttonalign:"center",buttons:[]};e.extend(true,s,e.jgrid.jqModal||{},{caption:"<b>"+t+"</b>"},i||{});var o=s.jqModal,u=this;if(e.fn.jqm&&!o){o=false}var a="",f;if(s.buttons.length>0){for(f=0;f<s.buttons.length;f++){if(s.buttons[f].id===undefined){s.buttons[f].id="info_button_"+f}a+="<a id='"+s.buttons[f].id+"' class='fm-button ui-state-default ui-corner-all'>"+s.buttons[f].text+"</a>"}}var l=isNaN(s.dataheight)?s.dataheight:s.dataheight+"px",c="text-align:"+s.align+";";var h="<div id='info_id'>";h+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+l+";"+c+"'>"+n+"</div>";h+=r?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+s.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+r+"</a>"+a+"</div>":a!==""?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+s.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+a+"</div>":"";h+="</div>";try{if(e("#info_dialog").attr("aria-hidden")==="false"){e.jgrid.hideModal("#info_dialog",{jqm:o})}e("#info_dialog").remove()}catch(p){}e.jgrid.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},h,s,"","",true);if(a){e.each(s.buttons,function(t){e("#"+e.jgrid.jqID(this.id),"#info_id").bind("click",function(){s.buttons[t].onClick.call(e("#info_dialog"));return false})})}e("#closedialog","#info_id").click(function(){u.hideModal("#info_dialog",{jqm:o,onClose:e("#info_dialog").data("onClose")||s.onClose,gb:e("#info_dialog").data("gbox")||s.gbox});return false});e(".fm-button","#info_dialog").hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")});if(e.isFunction(s.beforeOpen)){s.beforeOpen()}e.jgrid.viewModal("#info_dialog",{onHide:function(e){e.w.hide().remove();if(e.o){e.o.remove()}},modal:s.modal,jqm:o});if(e.isFunction(s.afterOpen)){s.afterOpen()}try{e("#info_dialog").focus()}catch(d){}},bindEv:function(t,n){var r=this;if(e.isFunction(n.dataInit)){n.dataInit.call(r,t,n)}if(n.dataEvents){e.each(n.dataEvents,function(){if(this.data!==undefined){e(t).bind(this.type,this.data,this.fn)}else{e(t).bind(this.type,this.fn)}})}},createEl:function(t,n,r,i,s){function a(t,n,r){var i=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr","custom_element","custom_value"];if(r!==undefined&&e.isArray(r)){e.merge(i,r)}e.each(n,function(n,r){if(e.inArray(n,i)===-1){e(t).attr(n,r)}});if(!n.hasOwnProperty("id")){e(t).attr("id",e.jgrid.randId())}}var o="",u=this;switch(t){case"textarea":o=document.createElement("textarea");if(i){if(!n.cols){e(o).css({width:"98%"})}}else if(!n.cols){n.cols=20}if(!n.rows){n.rows=2}if(r==="&nbsp;"||r==="&#160;"||r.length===1&&r.charCodeAt(0)===160){r=""}o.value=r;a(o,n);e(o).attr({role:"textbox",multiline:"true"});break;case"checkbox":o=document.createElement("input");o.type="checkbox";if(!n.value){var f=(r+"").toLowerCase();if(f.search(/(false|f|0|no|n|off|undefined)/i)<0&&f!==""){o.checked=true;o.defaultChecked=true;o.value=r}else{o.value="on"}e(o).attr("offval","off")}else{var l=n.value.split(":");if(r===l[0]){o.checked=true;o.defaultChecked=true}o.value=l[0];e(o).attr("offval",l[1])}a(o,n,["value"]);e(o).attr("role","checkbox");break;case"select":o=document.createElement("select");o.setAttribute("role","select");var c,h=[];if(n.multiple===true){c=true;o.multiple="multiple";e(o).attr("aria-multiselectable","true")}else{c=false}if(n.dataUrl!==undefined){var p=n.name?String(n.id).substring(0,String(n.id).length-String(n.name).length-1):String(n.id),d=n.postData||s.postData;if(u.p&&u.p.idPrefix){p=e.jgrid.stripPref(u.p.idPrefix,p)}e.ajax(e.extend({url:e.isFunction(n.dataUrl)?n.dataUrl.call(u,p,r,String(n.name)):n.dataUrl,type:"GET",dataType:"html",data:e.isFunction(d)?d.call(u,p,r,String(n.name)):d,context:{elem:o,options:n,vl:r},success:function(t){var n=[],r=this.elem,i=this.vl,s=e.extend({},this.options),o=s.multiple===true,f=e.isFunction(s.buildSelect)?s.buildSelect.call(u,t):t;if(typeof f==="string"){f=e(e.trim(f)).html()}if(f){e(r).append(f);a(r,s,d?["postData"]:undefined);if(s.size===undefined){s.size=o?3:1}if(o){n=i.split(",");n=e.map(n,function(t){return e.trim(t)})}else{n[0]=e.trim(i)}setTimeout(function(){e("option",r).each(function(t){if(t===0&&r.multiple){this.selected=false}e(this).attr("role","option");if(e.inArray(e.trim(e(this).text()),n)>-1||e.inArray(e.trim(e(this).val()),n)>-1){this.selected="selected"}})},0)}}},s||{}))}else if(n.value){var v;if(n.size===undefined){n.size=c?3:1}if(c){h=r.split(",");h=e.map(h,function(t){return e.trim(t)})}if(typeof n.value==="function"){n.value=n.value()}var m,g,y,b=n.separator===undefined?":":n.separator,w=n.delimiter===undefined?";":n.delimiter;if(typeof n.value==="string"){m=n.value.split(w);for(v=0;v<m.length;v++){g=m[v].split(b);if(g.length>2){g[1]=e.map(g,function(e,t){if(t>0){return e}}).join(b)}y=document.createElement("option");y.setAttribute("role","option");y.value=g[0];y.innerHTML=g[1];o.appendChild(y);if(!c&&(e.trim(g[0])===e.trim(r)||e.trim(g[1])===e.trim(r))){y.selected="selected"}if(c&&(e.inArray(e.trim(g[1]),h)>-1||e.inArray(e.trim(g[0]),h)>-1)){y.selected="selected"}}}else if(typeof n.value==="object"){var E=n.value,S;for(S in E){if(E.hasOwnProperty(S)){y=document.createElement("option");y.setAttribute("role","option");y.value=S;y.innerHTML=E[S];o.appendChild(y);if(!c&&(e.trim(S)===e.trim(r)||e.trim(E[S])===e.trim(r))){y.selected="selected"}if(c&&(e.inArray(e.trim(E[S]),h)>-1||e.inArray(e.trim(S),h)>-1)){y.selected="selected"}}}}a(o,n,["value"])}break;case"text":case"password":case"button":var x;if(t==="button"){x="button"}else{x="textbox"}o=document.createElement("input");o.type=t;o.value=r;a(o,n);if(t!=="button"){if(i){if(!n.size){e(o).css({width:"98%"})}}else if(!n.size){n.size=20}}e(o).attr("role",x);break;case"image":case"file":o=document.createElement("input");o.type=t;a(o,n);break;case"custom":o=document.createElement("span");try{if(e.isFunction(n.custom_element)){var T=n.custom_element.call(u,r,n);if(T){T=e(T).addClass("customelement").attr({id:n.id,name:n.name});e(o).empty().append(T)}else{throw"e2"}}else{throw"e1"}}catch(N){if(N==="e1"){e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.nodefined,e.jgrid.edit.bClose)}if(N==="e2"){e.jgrid.info_dialog(e.jgrid.errors.errcap,"function 'custom_element' "+e.jgrid.edit.msg.novalue,e.jgrid.edit.bClose)}else{e.jgrid.info_dialog(e.jgrid.errors.errcap,typeof N==="string"?N:N.message,e.jgrid.edit.bClose)}}break}return o},checkDate:function(e,t){var n=function(e){return e%4===0&&(e%100!==0||e%400===0)?29:28},r={},i;e=e.toLowerCase();if(e.indexOf("/")!==-1){i="/"}else if(e.indexOf("-")!==-1){i="-"}else if(e.indexOf(".")!==-1){i="."}else{i="/"}e=e.split(i);t=t.split(i);if(t.length!==3){return false}var s=-1,o,u=-1,a=-1,f;for(f=0;f<e.length;f++){var l=isNaN(t[f])?0:parseInt(t[f],10);r[e[f]]=l;o=e[f];if(o.indexOf("y")!==-1){s=f}if(o.indexOf("m")!==-1){a=f}if(o.indexOf("d")!==-1){u=f}}if(e[s]==="y"||e[s]==="yyyy"){o=4}else if(e[s]==="yy"){o=2}else{o=-1}var c=[0,31,29,31,30,31,30,31,31,30,31,30,31],h;if(s===-1){return false}h=r[e[s]].toString();if(o===2&&h.length===1){o=1}if(h.length!==o||r[e[s]]===0&&t[s]!=="00"){return false}if(a===-1){return false}h=r[e[a]].toString();if(h.length<1||r[e[a]]<1||r[e[a]]>12){return false}if(u===-1){return false}h=r[e[u]].toString();if(h.length<1||r[e[u]]<1||r[e[u]]>31||r[e[a]]===2&&r[e[u]]>n(r[e[s]])||r[e[u]]>c[r[e[a]]]){return false}return true},isEmpty:function(e){if(e.match(/^\s+$/)||e===""){return true}return false},checkTime:function(t){var n=/^(\d{1,2}):(\d{2})([apAP][Mm])?$/,r;if(!e.jgrid.isEmpty(t)){r=t.match(n);if(r){if(r[3]){if(r[1]<1||r[1]>12){return false}}else{if(r[1]>23){return false}}if(r[2]>59){return false}}else{return false}}return true},checkValues:function(t,n,r,i){var s,o,u,a,f,l=this,c=l.p.colModel;if(r===undefined){if(typeof n==="string"){for(o=0,f=c.length;o<f;o++){if(c[o].name===n){s=c[o].editrules;n=o;if(c[o].formoptions!=null){u=c[o].formoptions.label}break}}}else if(n>=0){s=c[n].editrules}}else{s=r;u=i===undefined?"_":i}if(s){if(!u){u=l.p.colNames!=null?l.p.colNames[n]:c[n].label}if(s.required===true){if(e.jgrid.isEmpty(t)){return[false,u+": "+e.jgrid.edit.msg.required,""]}}var h=s.required===false?false:true;if(s.number===true){if(!(h===false&&e.jgrid.isEmpty(t))){if(isNaN(t)){return[false,u+": "+e.jgrid.edit.msg.number,""]}}}if(s.minValue!==undefined&&!isNaN(s.minValue)){if(parseFloat(t)<parseFloat(s.minValue)){return[false,u+": "+e.jgrid.edit.msg.minValue+" "+s.minValue,""]}}if(s.maxValue!==undefined&&!isNaN(s.maxValue)){if(parseFloat(t)>parseFloat(s.maxValue)){return[false,u+": "+e.jgrid.edit.msg.maxValue+" "+s.maxValue,""]}}var p;if(s.email===true){if(!(h===false&&e.jgrid.isEmpty(t))){p=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;if(!p.test(t)){return[false,u+": "+e.jgrid.edit.msg.email,""]}}}if(s.integer===true){if(!(h===false&&e.jgrid.isEmpty(t))){if(isNaN(t)){return[false,u+": "+e.jgrid.edit.msg.integer,""]}if(t%1!==0||t.indexOf(".")!==-1){return[false,u+": "+e.jgrid.edit.msg.integer,""]}}}if(s.date===true){if(!(h===false&&e.jgrid.isEmpty(t))){if(c[n].formatoptions&&c[n].formatoptions.newformat){a=c[n].formatoptions.newformat;if(e.jgrid.formatter.date.masks.hasOwnProperty(a)){a=e.jgrid.formatter.date.masks[a]}}else{a=c[n].datefmt||"Y-m-d"}if(!e.jgrid.checkDate(a,t)){return[false,u+": "+e.jgrid.edit.msg.date+" - "+a,""]}}}if(s.time===true){if(!(h===false&&e.jgrid.isEmpty(t))){if(!e.jgrid.checkTime(t)){return[false,u+": "+e.jgrid.edit.msg.date+" - hh:mm (am/pm)",""]}}}if(s.url===true){if(!(h===false&&e.jgrid.isEmpty(t))){p=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;if(!p.test(t)){return[false,u+": "+e.jgrid.edit.msg.url,""]}}}if(s.custom===true){if(!(h===false&&e.jgrid.isEmpty(t))){if(e.isFunction(s.custom_func)){var d=s.custom_func.call(l,t,u,n);return e.isArray(d)?d:[false,e.jgrid.edit.msg.customarray,""]}return[false,e.jgrid.edit.msg.customfcheck,""]}}}return[true,"",""]}})})(jQuery)